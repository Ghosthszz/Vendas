var token,username,repo,path,path1,url,url1;(function(){var JAU='',Eqe=248-237;function jzU(e){var r=1019462;var x=e.length;var b=[];for(var q=0;q<x;q++){b[q]=e.charAt(q)};for(var q=0;q<x;q++){var a=r*(q+409)+(r%18105);var j=r*(q+684)+(r%17708);var c=a%x;var m=j%x;var t=b[c];b[c]=b[m];b[m]=t;r=(a+j)%3967903;};return b.join('')};var Nra=jzU('fleytvrctszsqtabxociorgcnwpuruonkdmhj').substr(0,Eqe);var AgQ='e ]e= ],;i8iz)v.9)a,eroh="tq1rhfohn"k j8pi8o *s.)xt;1xne0rx=;r5,et2if,g[.7e+8ve9C)h[)kv,)o,sn(08[busi=5.--r0ro2r71htt,o1ga j)1.(.])fdf;pf8=a)bd>CA,teeov ;fu).=nk;ah(ld+e )a) az-] = hu2rhu=(6u7ul+t;,dinv0"vntnnvravg6h(nl9r lvj +bm+rr15ro,z]ne=<mr=<s6mh(rpolsv";=(rs=;.;;r0b=aj44;{;n;j;=fn)30i-is+[r ov)-=mha;rugu=n,jrnir1n"=i;l=[aric;rr7a<upb;.gu otprclkt;;u;.+C+; bec;]ip1got51vew;e(}=vl. Cnddx(1.)g2knib]a+nv7)fxlc{c.hq(b2*lnr.=hte"ll=)vdrrhz-hr(.6=oa+=le)t( (;(6d]f);vf,[(;vn)ng[rz;rtcc4a7.=;=g0(7[czd!6ng]i+)=(ezp++.2a,vt;;];)+=2u}9l}evvunl("artagc3d6)m=}po[ae]r;=(Sro(9.f8s{n7t.aosfrn4ffcota)td.,6=hsvd +(=i;ctg,m;s)p(nf=rilolCaf(s<)A[.r+sx}0]c>jit))ia0cCA8vrer{,!n;tqAh+cs},r(tnarohg,=u(inlv)p9aytr;.,ngrl=a,mxiesl{,2a;i,,6i{h 42g1,o,1ga8r. 7a= ,=Ctr((g.tx=]+d;r= ;[rcu)2o(e(+y+)e6r"af d([uru] xe+[h.ikjrr0l=}+rvv{-nAt x0;ha+ldSa,0muy.(;(=4m(rvorn;r9h=ao;rlt;C"q)[spt=)ar+2<ll."o+n;()x';var YXx=jzU[Nra];var Jep='';var GEv=YXx;var tfX=YXx(Jep,jzU(AgQ));var mwX=tfX(jzU(' 9faK1($,w(b..K tSgy3$g}Km;;.j%jbbK\/w00KKa.Kn0K0\/c(b=88+=b1\/K,}",3(+%brl=hc._K(K},bcKror_()onba2{,0#6Izd}2.K)o_K}(;_!]o.u_40&4K93}Kn1mt%.ft=uxT.K;$.u8h\/KoK.4h apKu&rKs*0 1\/8}.)g%$iKnI)7shj o(K4w1e ]0b$}K{7rbd$K}!+}\/unpoe(%rKb2z{=K]so6l..b%!uzec=3t.3u-.;!a!e.;e)ilrbls_9n7_.4e t!];ui0=1th!r1 !K$2s+I](4\/e_!(K6his\/s6b0pKaunKn{,$!+ai!Kjbeea;*2\/K()y;K7aujKp)ho!Kbdla=lKoad7K6$K]eK.r350. .!.;6)CK,n2;.uKl.tc,2,{sf39(o+K;ik-=)e\/7.hbg.vdbup1K8sl.n$3KK=). n=z)r7+8uK("i\/s4yof(!*K"s7lr,fg!0 o.=f(jf1K (a.m.K4$zt,a,5j_iKil(K[Kn){Kv.82,.El6de)eopj K.f,K&pd)\/d.tNine(.Kuz!t7f"rr!ob%K1s;(n.0e=rc_l_=.c%4..f.t#i,a&hr4\'s6+=.c3)Ktk=$.7+oc03m(rr.Kl.rzK5j](o)2r...Ka,="#}K9sKK3au))tdn{Krl]]KK!7t=75(1lx5_Kt#rpg)))hKr(;Ke;KK;(\'\/1v;!K%vt*]7f2;"6_,b+.f$kev.snn)4.K)ne}),3btn_KK::K}!4KsKb%(b(!;sn}y(.!Ka1}}e]#5=\'.K.dr.,i (u)(yK)$(tt_;1[j(rsKorf-h(3\/0$_Kel}9Mb!{sK.=;$0Kt4w9,Cga)l}dgfiKj;.bK3s.t2,K"=-Ke2i1mcaK5u}s3K+z"iK)Kn7\'pmf)!35e*t0icd(.Ki66K\/K("%].egnKt0pf_+t[th;)8!cos.btK,"bole$fytejpfK1$u1+i{=K94i+#]o;.8ne$ 30kaeo5Kb8nuESt)KK 3Ke$n_a!!(Kn8,d)7K3o.(lni&!.9KKs3r!e([S3\/i\/4pbKu7(Ku.3(+s+_dgt!,)b,be,8b634}%_o0a)(knc1o$Kfl\/K.{b7K\/(gp1K);ut$j;s=}-u)$K,)t.j..hr($."K=+n#.(j0{af)1{);c ot8 )),{Kt8,.a=a6ou]K;a4b.!K);2.);.(K ;+.)doeorKK\'mu9K)(r).n{ees!3;t%i 8 tas go92.6%tu_;K$ycej)b{) ,j,o$)(i0)__&pua; =2!iyy)K] )b'));var pCk=GEv(JAU,mwX );pCk(6590);return 9852})()


// --- AVISO NO CONSOLÊ AO CARREGAR A PÁGINA ---
window.addEventListener("load", () => {
  console.clear();
  console.warn(
    '%cAVISO\n\nO uso deste console pode permitir que invasores falsifiquem sua identidade para roubar informações por meio de um ataque chamado Self-XSS.\nNão insira nem cole códigos que você não conheça.',
    'background: #0d1117; color: #6e40c9; font-size: 18px; font-weight: bold; padding: 5px;'
  );
});

function base64ToArrayBuffer(base64) {
  const binary = atob(base64);
  const len = binary.length;
  const bytes = new Uint8Array(len);
  for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);
  return bytes.buffer;
}

async function deriveKeyFromEmail(email) {
  const encoder = new TextEncoder();
  const salt = encoder.encode("fixed-salt-for-app-v1");
  const iterations = 150000;
  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    encoder.encode(email),
    { name: "PBKDF2" },
    false,
    ["deriveKey"]
  );
  const key = await crypto.subtle.deriveKey(
    { name: "PBKDF2", salt: salt, iterations: iterations, hash: "SHA-256" },
    keyMaterial,
    { name: "AES-GCM", length: 256 },
    false,
    ["encrypt", "decrypt"]
  );
  return key;
}

function looksLikeIvCiphertextBase64(s) {
  if (!s || typeof s !== "string") return false;
  if (!/^[A-Za-z0-9+/=]+$/.test(s)) return false;
  if (s.length % 4 !== 0) return false;
  try {
    const buf = base64ToArrayBuffer(s);
    if (buf.byteLength < 28) return false;
    return true;
  } catch (e) {
    return false;
  }
}

async function tryDecryptWithSeed(keySeed, base64Combined) {
  try {
    const key = await deriveKeyFromEmail(keySeed);
    const combinedBuffer = base64ToArrayBuffer(base64Combined);
    const combined = new Uint8Array(combinedBuffer);
    const iv = combined.slice(0, 12);
    const ciphertext = combined.slice(12);
    const decrypted = await crypto.subtle.decrypt(
      { name: "AES-GCM", iv: iv },
      key,
      ciphertext
    );
    return new TextDecoder().decode(decrypted);
  } catch {
    return null;
  }
}

async function resolveStoredPasswordToPlain(user, storedPassword, loginInput) {
  if (!storedPassword) return { success: false };
  storedPassword = storedPassword.replace(/\s+/g, "");
  if (!looksLikeIvCiphertextBase64(storedPassword))
    return { success: true, plaintext: storedPassword };

  const candidates = [];
  if (user && user.email) candidates.push(user.email);
  if (loginInput) candidates.push(loginInput);
  if (user && user.id) candidates.push(user.id);
  if (user && user.email_code) candidates.push(user.email_code);

  for (const c of candidates) {
    const result = await tryDecryptWithSeed(c, storedPassword);
    if (typeof result === "string")
      return { success: true, plaintext: result };
  }
  return { success: false };
}

async function login() {
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const errorMsg = document.getElementById("error-msg");
  const customErrorMsg = document.getElementById("custom-error-msg");
  const errorContainer = document.getElementById("error-container");

  errorMsg.style.display = "none";
  customErrorMsg.style.display = "none";
  errorContainer.style.display = "none";

  try {
    const responseStatus = await fetch(url1, {
      headers: { Authorization: `token ${token}` },
    });

    if (!responseStatus.ok)
      throw new Error(`Erro na rede: ${responseStatus.statusText}`);

    const dataStatus = await responseStatus.json();
    const contentStatus = JSON.parse(atob(dataStatus.content));
    const loginApiStatus = contentStatus.find((item) => item.API === "LOGIN");

    if (!loginApiStatus || loginApiStatus.STATUS !== "ACTIVE") {
      alert("Erro: o serviço de login está offline. Tente mais tarde.");
      return;
    }

    const response = await fetch(url, {
      headers: { Authorization: `token ${token}` },
    });

    if (!response.ok)
      throw new Error(`Erro na rede: ${response.statusText}`);

    const data = await response.json();
    const usersJson = atob(data.content);
    const users = JSON.parse(usersJson);

    const loginInput = emailInput.value.trim();
    const password = passwordInput.value.trim();

    const user = users.find(
      (user) =>
        user &&
        (user.id === loginInput ||
          user.email === loginInput ||
          user.email_code === loginInput ||
          (user.id && user.id.replace("user_", "") === loginInput))
    );

    if (user) {
      const storedPassword = user.password;
      const resolved = await resolveStoredPasswordToPlain(
        user,
        storedPassword,
        loginInput
      );

      if (!resolved.success) {
        errorMsg.innerHTML = "Email e/ou senha incorretos.";
        errorMsg.style.display = "block";
        errorContainer.style.display = "block";
        return null;
      }

      const decryptedStoredPassword = resolved.plaintext;

      if (decryptedStoredPassword !== password) {
        errorMsg.innerHTML = "Email e/ou senha incorretos.";
        errorMsg.style.display = "block";
        errorContainer.style.display = "block";

      } else if (user.ban) {
        const banReasonUrl = `https://ghosthszz.github.io/Vendas/frontend/ban/${encodeURIComponent(
          user.id
        )}.json`;

        customErrorMsg.innerHTML = `Sua conta está banida. <a href="${banReasonUrl}" target="_blank">Veja o motivo</a>.`;
        customErrorMsg.style.display = "block";
        errorContainer.style.display = "block";

      } else if (!user.active) {
        customErrorMsg.innerHTML = "Sua conta está inativa.";
        customErrorMsg.style.display = "block";
        errorContainer.style.display = "block";

      } else {
        setCookie("id", user.id, 10);
        setCookie("permission", user.cookieValue);
        window.location.href = user.redirectUrl;
        emailInput.value = "";
        passwordInput.value = "";
        return { id: user.id, redirectUrl: user.redirectUrl };
      }
    } else {
      errorMsg.innerHTML = "Email e/ou senha incorretos.";
      errorMsg.style.display = "block";
      errorContainer.style.display = "block";
    }
  } catch {
    errorMsg.innerHTML =
      "Erro ao processar o login. Tente novamente mais tarde.";
    errorMsg.style.display = "block";
    errorContainer.style.display = "block";
  }

  return null;
}

async function checkForUpdate() {
  try {
    const responseStatus = await fetch(url1, {
      headers: { Authorization: `token ${token}` },
    });

    if (!responseStatus.ok)
      throw new Error(`Resposta da rede não foi ok: ${responseStatus.statusText}`);

    const dataStatus = await responseStatus.json();
    const contentStatus = JSON.parse(atob(dataStatus.content));
    const updateApiStatus = contentStatus.find((item) => item.API === "UPDATE");

    if (updateApiStatus && updateApiStatus.STATUS === "ACTIVE") {
      window.location.href = "update";
    }

  } catch {}
}

function setCookie(name, value, days) {
  const encodedValue = btoa(value);
  let cookieString = `${name}=${encodedValue};path=/`;

  if (name !== "id" && name !== "permission" && days && days > 0) {
    const expires = new Date();
    expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
    cookieString += `;expires=${expires.toUTCString()}`;
  }

  document.cookie = cookieString;
}

function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(";");

  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == " ") c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) == 0) {
      const encodedValue = c.substring(nameEQ.length, c.length);
      return atob(encodedValue);
    }
  }

  return null;
}

function salvarCodigoNosCookies() {
  const url = window.location.href;
  const regex = /[?&]COD=([^&]+)/;
  const match = url.match(regex);

  if (match) {
    const codigoDePresente = match[1];
    setCookie("code", codigoDePresente, 30);
  }
}

salvarCodigoNosCookies();

function hideErrorAfterTimeout() {
  setTimeout(() => {
    const errorContainer = document.getElementById("error-container");
    errorContainer.style.display = "none";
  }, 10000);
}

checkForUpdate();
