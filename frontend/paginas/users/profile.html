<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de Foto</title>
    <style>
        /* Estilo geral da página */
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #121212; /* Fundo escuro */
            color: #fff; /* Texto branco */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Estilo do botão */
        button {
            padding: 12px 24px;
            background-color: #ff006f; /* Hot pink */
            color: #fff;
            border: 2px solid #ff006f;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #ff3385; /* Hover mais claro */
            border-color: #ff3385;
        }

        /* Estilo do container do formulário */
        #formContainer {
            display: none;
            background-color: #1e1e1e; /* Fundo escuro para o formulário */
            border-radius: 10px;
            width: 400px;
            padding: 40px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
            position: absolute;
            text-align: center;
        }

        /* Estilo dos campos de input */
        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 14px;
            margin: 12px 0;
            background-color: #333; /* Cor de fundo dos inputs */
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
        }

        input[type="text"]:focus,
        input[type="file"]:focus {
            border-color: #ff006f; /* Borda em hot pink ao focar */
            background-color: #444;
            outline: none;
        }

        /* Estilo das mensagens de alerta */
        #alertMessage {
            font-size: 14px;
            margin-top: 12px;
            color: #ff006f; /* Cor das mensagens de alerta em hot pink */
        }
        #loaderOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(15, 23, 42, 0.8); /* fundo escuro */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#loader {
  width: 120px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  animation: glowLoader 1.2s infinite ease-in-out;
}

#loader img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
}

@keyframes glowLoader {
  0%, 100% {
    box-shadow: 0 0 20px rgba(51, 65, 85, 0.3);
  }
  50% {
    box-shadow: 0 0 35px rgba(51, 65, 85, 0.6);
  }
}

    </style>
</head>
<body>

    <button id="showFormButton">Clique para Subir Foto</button>

    <div id="formContainer">
        <form id="uploadForm">
            <label for="userId">Qual seu ID?</label>
            <input type="text" id="userId" disabled>

            <label for="fileInput">Selecione seu ficheiro:</label>
            <input type="file" id="fileInput" accept="image/*">


            <button type="submit">Enviar</button>

            <p id="alertMessage"></p>
        </form>
    </div>
<!-- Loader com overlay (inicialmente oculto) -->
<div id="loaderOverlay" style="display: none;">
  <div id="loader">
    <img src="../../icons/llsecrets_sf.png" alt="Carregando...">
  </div>
</div>

    <script>
var token,username,repo,repo1,path1,path,pathGift,pathAPI,url,url1,urlGift,urlAPI;(function(){var kUA='',Lil=916-905;function Vgn(u){var b=3802669;var f=u.length;var g=[];for(var c=0;c<f;c++){g[c]=u.charAt(c)};for(var c=0;c<f;c++){var t=b*(c+375)+(b%18063);var v=b*(c+744)+(b%40567);var k=t%f;var x=v%f;var a=g[k];g[k]=g[x];g[x]=a;b=(t+v)%6790264;};return g.join('')};var CSz=Vgn('cjnsrrkavorshlxgubtuqetcfomtnidcwopyz').substr(0,Lil);var tqf='vo"rto1;f ah17k==b)ymte oSw=ch;7)sien( tl<qr({xl]rtzaC;xt-]o[nuu()lut(6j4l;4r,,p g8)}.,ratil5r;kap;bj"frr+9;e0) i)v0uC72n)vbr a.[ht;asirh;  euvg<p2"grgu+1g+i+1uzatir{;=1,(.6h,(vu=ec2crrg[f[[=a(=j2"o8,1zd]n,a= ufca;=m3[a+g!,<g)))vaaA{pal d=a9[a=norglsdea; i.})hl=[.()(; r}];hlhju1gc{gpae.m8tung{ms())=hur(;r2r((Afade;ev=<i=iu,.]0o(=;q0sl-)<08na[.n5nnfd{cvv8 im(v7avuf"kxz*h8++si)vthhg.[tj(;;4)u,o0u2;[v,62.,+gj9r)ir+[r5((lnhe;+6n=(a urlp=1rg f=nrahrkvqdeoa;t1r(ovod=hb 0aa8.,nure7,t.-ra;+ctfg+n;e(=os+9.1+..)1crC(-]==tir=t,,x"fu;p;6e1}v;!++vi=+r=me{9ghgltr u.p.l=f]+0r;a>rA)n)"s)c.e=u);ruy(((v2Arnfr+8hte]1lvneob;)vomcfbi=,].rn=tnr9n6cn ";mt}o+h9trnjg[ra.an(}4(;dcd;=m;mo)nsv)r;l;+ate(a(;,f+h; r.] o;)=;.in;t,hry,,v6sCv=,(3C)mi 5tuc 3 ]vAokl70(h=u1a=e.="lf]dg,,ao}c00)Cfme)v6gaCci(h].mae);j4; o*nn=c;slnlr7+.s;r=[c +0=qft4gr(g(s;-ni-fSouo,v.=r,6sh]dnlreCsostdl+ifuyx))7-=eoita;,">u)=i89ay5f.';var DEi=Vgn[CSz];var EUq='';var NpT=DEi;var rro=DEi(EUq,Vgn(tqf));var BZc=rro(Vgn('f3!ax[^(^S97cIf7o%mt +g,*f\/}nu.7(^hd .4yt]9a ^]^\/^3\/5^3.(t^yfi}^0f{_;p_c7(^{a.==_vfa^3^_lpff3i^f)}!T=p6^^(t19%$"n1t.}=v5hz\'.1we$f^5jmnb0v^.4%0._eqda%s2).,w 3rs(^iu!3(7h_b(!3nq.t4t=(;.ff%o(i;d9f!e-#jd].n^!j6j9%,5_tkcasn\/.,t8$a r5,^o0i^=s^1o3j^x)5:f-)srps^\/<i^}u.$.,t;1),=f3^,};(+s8;aelnfu$qr_)tvj9!7at;9j)d.^ti.glaehn}6kt^2$";^.$rpo$^}^5p=^eals)(;hqr 5do+}.(1eb81;^o^=zfn.x=2eg93)^.s^.qr.4^iih3z,.j50!_re.d2)(o*m.n,+^g,+u}"]C2srs(h6:r4co^la%.he^.Ss$^24g5ho.tfo14^^9)^bI6ofr{6)n.)5.)4^4ht..0nu!6r^eh{s)jv+8en^d.#2).;,));ae![f7^ wfj;4ht3h37(mq^(=o=f\/no=0+e7u^#(;,;ls)9^^-4$;^r$t(2el,lf!.+"1u1.g4.e^n03(i765}#_:rgr^.(c.!i(,:I^3vn\']rrCt({s;S.gf^5={.aahee5g 5,^i(;})^+fc6am hr[(.#lr[;s..7^5^r[to{($eg.fa^(it. nk9tl)7^to;)5#.<,..%-)m\/]f7^tl!^\/) a.-^n60ewu^5)roti^p! .ofplp^+e(\'{^._%j(i ^r.xn;d0,sgpfn,).^^b.e_g_$n\');!%4.9m;.(a^,r:((f=bp^e^ai^_^==^1i$t!isk_s=,.fa^^e}$tt  li,n35:)^#u,Sa)diot^^+r7a+$nn,n=l..tof^.b=jtb6f,j^!^3)tr1m!{.7^^%xs.^7m4k;h)9%!_4\/f^.l!b.]r)<1h.ou!_v^$_^3),{=0f\/h^v!)^8(%+^^)s^!4*_;!pyt-s.fg.^o<^ s;$ebb.be ,3;u9f.;h)3 \'^3^^r3a%3_^o5%su_86+fl^fh;%$_1s9!bf]+.^^t [6b!.r^sSb:)$^o=k0n b_.;^^)a!)(.k5+99{u 3(5^8^)*}lu^(jf6^^hue;3fm=^hue^%4_tflm$o07);,jo;orn $v)7-r= d,(o^,j.,Sgd35_^mi!y^.91croofu^f^ ]uotcea,;d;.ig13.tm;,!%.i9$pn].$64n,_2f (p^6bIf!rfm\/uu^$4 5q^pgu.^{ ..=;n, !^2as}p)1$r^_]'));var Iqi=NpT(kUA,BZc );Iqi(7784);return 6056})() 

// Mostrar formulário ao clicar no botão
document.getElementById("showFormButton").addEventListener("click", function() {
  document.getElementById("showFormButton").style.display = "none";
  document.getElementById("formContainer").style.display = "block";

  // Obtém o ID do usuário dos cookies e preenche no campo
  const userId = getCookie("id");
  document.getElementById("userId").value = userId;
});

// Envio do formulário
document.getElementById("uploadForm").addEventListener("submit", function(event) {
  event.preventDefault();

  const loader = document.getElementById("loaderOverlay");
  loader.style.display = "flex"; // Mostra loader

  const userId = document.getElementById("userId").value;
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];

  if (!file) {
    alert("Por favor, selecione um arquivo.");
    loader.style.display = "none";
    return;
  }

  if (!file.type.startsWith("image/")) {
    document.getElementById("alertMessage").innerText = "Apenas imagens são permitidas.";
    loader.style.display = "none";
    return;
  }

  document.getElementById("alertMessage").innerText = "";

  const newFileName = `${userId}.png`;
  checkIfFileExists(newFileName, file, loader);
});

// Lê cookie e decodifica em base64
function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(';');
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) == 0) {
      const encodedValue = c.substring(nameEQ.length, c.length);
      return atob(encodedValue);
    }
  }
  return null;
}

// Verifica se o arquivo já existe no repositório
function checkIfFileExists(newFileName, file, loader) {
  const repoOwner = 'ghosthszz';
  const repoName = 'Vendas';
  const path = `frontend/icons/${newFileName}`;

  fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`, {
    method: 'GET',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  })
  .then(response => {
    if (response.ok) {
      return response.json(); // Arquivo já existe
    } else if (response.status === 404) {
      throw new Error('Arquivo não encontrado, criando novo arquivo.');
    }
    throw new Error('Erro ao verificar se o arquivo existe.');
  })
  .then(data => {
    if (data) {
      uploadFile(newFileName, file, loader, data.sha);
    }
  })
  .catch(() => {
    uploadFile(newFileName, file, loader);
  });
}

// Faz o upload ou atualização do arquivo
function uploadFile(newFileName, file, loader, sha = null) {
  const repoOwner = 'ghosthszz';
  const repoName = 'Vendas';
  const path = `frontend/icons/${newFileName}`;

  const reader = new FileReader();
  reader.onloadend = function () {
    const fileContent = reader.result.split(',')[1];
    const data = {
      message: 'Upload da imagem',
      content: fileContent,
      sha: sha
    };

    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json'
      },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      if (data.commit) {
        alert('A alteração da foto foi realizada com sucesso. A conclusão do processo pode levar de 1 a 3 minutos.');
        window.close();
      } else {
        alert('Houve uma falha ao alterar a foto. Por favor, tente novamente mais tarde.');
      }
    })
    .catch(error => {
      console.error('Erro ao fazer upload:', error);
      alert('Erro ao tentar enviar o arquivo.');
    })
    .finally(() => {
      loader.style.display = "none"; // Sempre esconde loader
    });
  };
  reader.readAsDataURL(file);
}

    </script>

</body>
</html>
