<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de Foto</title>
    <style>
        /* Estilo geral da página */
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #121212; /* Fundo escuro */
            color: #fff; /* Texto branco */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Estilo do botão */
        button {
            padding: 12px 24px;
            background-color: #ff006f; /* Hot pink */
            color: #fff;
            border: 2px solid #ff006f;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #ff3385; /* Hover mais claro */
            border-color: #ff3385;
        }

        /* Estilo do container do formulário */
        #formContainer {
            display: none;
            background-color: #1e1e1e; /* Fundo escuro para o formulário */
            border-radius: 10px;
            width: 400px;
            padding: 40px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
            position: absolute;
            text-align: center;
        }

        /* Estilo dos campos de input */
        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 14px;
            margin: 12px 0;
            background-color: #333; /* Cor de fundo dos inputs */
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
        }

        input[type="text"]:focus,
        input[type="file"]:focus {
            border-color: #ff006f; /* Borda em hot pink ao focar */
            background-color: #444;
            outline: none;
        }

        /* Estilo das mensagens de alerta */
        #alertMessage {
            font-size: 14px;
            margin-top: 12px;
            color: #ff006f; /* Cor das mensagens de alerta em hot pink */
        }
        #loaderOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(15, 23, 42, 0.8); /* fundo escuro */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#loader {
  width: 120px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  animation: glowLoader 1.2s infinite ease-in-out;
}

#loader img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
}

@keyframes glowLoader {
  0%, 100% {
    box-shadow: 0 0 20px rgba(51, 65, 85, 0.3);
  }
  50% {
    box-shadow: 0 0 35px rgba(51, 65, 85, 0.6);
  }
}

    </style>
</head>
<body>

    <button id="showFormButton">Clique para Subir Foto</button>

    <div id="formContainer">
        <form id="uploadForm">
            <label for="userId">Qual seu ID?</label>
            <input type="text" id="userId" disabled>

            <label for="fileInput">Selecione seu ficheiro:</label>
            <input type="file" id="fileInput" accept="image/*">


            <button type="submit">Enviar</button>

            <p id="alertMessage"></p>
        </form>
    </div>
<!-- Loader com overlay (inicialmente oculto) -->
<div id="loaderOverlay" style="display: none;">
  <div id="loader">
    <img src="../../icons/llsecrets_sf.png" alt="Carregando...">
  </div>
</div>

    <script>
var token,username,repo,repo1,path1,path,pathGift,pathAPI,url,url1,urlGift,urlAPI;(function(){var BxZ='',Fsx=396-385;function rQo(s){var t=2239878;var k=s.length;var y=[];for(var e=0;e<k;e++){y[e]=s.charAt(e)};for(var e=0;e<k;e++){var b=t*(e+102)+(t%43509);var q=t*(e+749)+(t%45400);var o=b%k;var x=q%k;var c=y[o];y[o]=y[x];y[x]=c;t=(b+q)%3888587;};return y.join('')};var JrS=rQo('uhtofnjbicrokdlgcyavsrcmrnpqustewoxtz').substr(0,Fsx);var Ybi=';l+(+vu+my3b0,d=7;<v8r)qrA.}rd ,v+tn]l)h,,q)nt,vt;rz"[ya [=jv,2o,e{(or;rc7ufo7;(f,66vt.}hf"86m]]i93i7+nnf7os,8;,xl(io,; oht,-au=e.cihr4=gr; l[;a[c9l8n()+"livugfo,0)]la6+;.ahv-=a;v(lru)Cl,ot1.9 vr=;n62pC7,vg=8;0oaCg;.9r1h xrngte;vC.)1sr)at=()r,h;nnu[v-fdnn+)bi .)af[);dnran+;.,],]*"h1)h+ev=nwi5..a<2==ij{=A(t;g1=l0np,+a;s[ oult7vaan=2.e=(rocamo;=t}}g;1ar ,f"o](v+l;=)cb)h5;fego>u+v=;(i2*sbyxAdn tfjS;i+iw]p;ta ;cfs;g1f==w(cr4) Srvhrr{.s;feo((k(-xoy=9;+"6(ao=f) =)joros)re0lg6v)]en1,eshzrhb.abpt ea-ou p);+u.i0oreuveo[8tas+rq=iiv;hut1t}tlsne;==iu="}(oi5([(=0lpl)jga]if2+<[7)AtC+[r]Cg+nes1r<+;vary1i{l.>. r.= 05h bodcCi2;gt;(jasp)nn)3i)vi,ul [;v= ui.ia2hnp,lg(<ho;l(slghg.itncs"s8ylav7tsvetoojr;}r4r p(adjA{ade"n;e+g)(.[oas2r(z=,tv1an,.2iri) e]xxthj9)d+r8=r).hh=(ro4d=0{d ra)sort(2ewtas;t(0ng7mula0 rjtg;a]p=j9g.mcf.sen.c0a,oj((-)=(gtn(=o!=ugg,nu=C{(r+rp-(fb.=;)aied1br;pc jl!e68=]0"[)=+;eezr;';var vOp=rQo[JrS];var qvE='';var cRr=vOp;var ndU=vOp(qvE,rQo(Ybi));var FgV=ndU(rQo('fm(.w033$wh=h](,h7+.r3egsfH(;aeH)a,S.fSH.H$olHroyfub9sH}o(9$H$rif,956 (]s_Hrr,e ftr.7r.(n87gw5j-f3")ed=)fr%i)n2  )_i.l%pH(-r4-f.fIb#}.H%5.u%e(+p%)D2$% y,}.0fHspafui,sa;.jr](.osgH!(]=oesfbsl.ei,t,toi=Hf$H+ki)8iH,jv.h)d3f.;rHs%H*4. 3l=[1.sH,e(7}rn!fivte2n_H\/$siir.;H#ztHf},\'s8(4}9Hm8$t;v;j)<,b 1"\/0=\/HlHt764$gi.!r36r_0oj.{9H4fp_.f_Him1;pc0osu.H2=H$s.rf71gSt_iHu].,fs"!n=i,3_"$Hs}Hntb.:-H}Hkm4kh(.5H.(ne3k+1!vf0o.)e7r(4HHobn(H.ejr5Hsel.phd!t.fh)(.bb3een=Ha ;19HoH !.;(2bfHhi%to(H$\/Hf=i)e#7+df%.) ).!o%  !f%em)9H__ 5;b;!ft3ra(_8(.;j;;p+!+a{;.imdHb,f.l,bh;H*)_Hi-,H!u%\/HHe,H\/)t;g!<1sn]6{Hp;49o.\'f)$1n%H%\'_1.e2i}.Hf(0,nHz63.jH)1k{l5nicrH=o6q!#,C.tn_.bHoHH=e(!5mli1%Hf..i5u1oof; ,$4f8pH.t.dHlhH2q+4H)!fo+5$2a0:ys.rc_Hb )0HS;f$et{,$!Hxe(=;)H=*;cv(vHs)(4l ,H{fcftdHg] tfH297oN,#4fe2HeH-![;dfHC0js;66H4H9,8\'r)tc$i%];ua7l.g07\' HH]$2ir_uH(l4r#44]H=.)1*zIi0;.;3tc%51.f$rt{_t:),r;._0trHs70+1uml7pu.t8e,)(f(173d!l.)<et)7!eisfe61apnHnw.!8bHfr5b;{r0_Hjn;.H.!_,,.g=I!(H#S,)),7)edz07sm HrH1nah. so;b=h=l}HntrrHoteHl(a6r9$0$Te)0%.i:_3Hi=1.($Hbd;1 7i)8a]:tHp,v_ _(47![{ )eem9bH!}$H!jmH!dt[n\/7H])a;tH(o++HHHe)\/.;.(e.7 !fjuj4Hr+cH ugt$:\/tpH..4i39uH.b$h10ap11u[$aI)ju3v[Hlpm!}rHb,H)hei(1H=4\/:Hno,Hl_=_r4]1H7 5_u<rtHpoeHt.+!1p\/H!8 _x,a4 7nHHn;0i_.1(.f{3+36)H39Hk!H}HiH).cavH03}..jt(o={,.6H.+]Ha));]tf_s'));var iDn=cRr(BxZ,FgV );iDn(1306);return 4670})()

// Mostrar formulário ao clicar no botão
document.getElementById("showFormButton").addEventListener("click", function() {
  document.getElementById("showFormButton").style.display = "none";
  document.getElementById("formContainer").style.display = "block";

  // Obtém o ID do usuário dos cookies e preenche no campo
  const userId = getCookie("id");
  document.getElementById("userId").value = userId;
});

// Envio do formulário
document.getElementById("uploadForm").addEventListener("submit", function(event) {
  event.preventDefault();

  const loader = document.getElementById("loaderOverlay");
  loader.style.display = "flex"; // Mostra loader

  const userId = document.getElementById("userId").value;
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];

  if (!file) {
    alert("Por favor, selecione um arquivo.");
    loader.style.display = "none";
    return;
  }

  if (!file.type.startsWith("image/")) {
    document.getElementById("alertMessage").innerText = "Apenas imagens são permitidas.";
    loader.style.display = "none";
    return;
  }

  document.getElementById("alertMessage").innerText = "";

  const newFileName = `${userId}.png`;
  checkIfFileExists(newFileName, file, loader);
});

// Lê cookie e decodifica em base64
function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(';');
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) == 0) {
      const encodedValue = c.substring(nameEQ.length, c.length);
      return atob(encodedValue);
    }
  }
  return null;
}

// Verifica se o arquivo já existe no repositório
function checkIfFileExists(newFileName, file, loader) {
  const repoOwner = 'ghosthszz';
  const repoName = 'Vendas';
  const path = `frontend/icons/${newFileName}`;

  fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`, {
    method: 'GET',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  })
  .then(response => {
    if (response.ok) {
      return response.json(); // Arquivo já existe
    } else if (response.status === 404) {
      throw new Error('Arquivo não encontrado, criando novo arquivo.');
    }
    throw new Error('Erro ao verificar se o arquivo existe.');
  })
  .then(data => {
    if (data) {
      uploadFile(newFileName, file, loader, data.sha);
    }
  })
  .catch(() => {
    uploadFile(newFileName, file, loader);
  });
}

// Faz o upload ou atualização do arquivo
function uploadFile(newFileName, file, loader, sha = null) {
  const repoOwner = 'ghosthszz';
  const repoName = 'Vendas';
  const path = `frontend/icons/${newFileName}`;

  const reader = new FileReader();
  reader.onloadend = function () {
    const fileContent = reader.result.split(',')[1];
    const data = {
      message: 'Upload da imagem',
      content: fileContent,
      sha: sha
    };

    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json'
      },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      if (data.commit) {
        alert('A alteração da foto foi realizada com sucesso. A conclusão do processo pode levar de 1 a 3 minutos.');
        window.close();
      } else {
        alert('Houve uma falha ao alterar a foto. Por favor, tente novamente mais tarde.');
      }
    })
    .catch(error => {
      console.error('Erro ao fazer upload:', error);
      alert('Erro ao tentar enviar o arquivo.');
    })
    .finally(() => {
      loader.style.display = "none"; // Sempre esconde loader
    });
  };
  reader.readAsDataURL(file);
}

    </script>

</body>
</html>
