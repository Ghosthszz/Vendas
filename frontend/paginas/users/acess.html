<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasta de Arquivos</title>
    <link rel="stylesheet" href="../../css/acess.css">
</head>
    <style>
    @media (max-width: 720px) {
        #token {
        font-size: 6px;
        padding: 8px;
    }
    #dark-mode-user {
        top: -30px;
        left: 300px;
        width: 30px;
        height: 30px;

    }
}
</style>
<body>
    <div id="token">
        <h1>Seu cupom:</h1>
    </div>
    <div>

    </div>
    <div id="comp1" class="container">     
        <h1 id="past" >Pasta de Arquivos

<!-- 
<div id="fundo" class="fundo-escuro"></div>
<div id="imagem-container" class="modal">
    <img src="../../icons/aviso-pc.png" id="imagem-maior" class="imagem" alt="Imagem para telas maiores">
    <img src="../../icons/aviso-cell.png" id="imagem-menor" class="imagem" alt="Imagem para telas menores" style="display: none;">
</div>
-->


            <button id="dark-mode-user"onclick="toggleUserInfo()"><img id="user" src="../../icons/user1.png" alt="user-profile" style="top: -30px; left: 320px; width: 27px; height: 27px; border-radius: 50%; object-fit: cover; margin: 1.5px;"> 

            </button> </h1>

         <div class="container1">
            <p><strong>Saldo:</strong> <span  id="toggleSaldo" class="saldo">****</span><span id="saldo" class="icon">${usuario.saldo}</span></p> <img id="toggleButton" src="../../icons/mostrar.png" alt="oculto">
        </div>
         <ul class="file-list">

            <ul class="pagination">
            <li><a href="#comp1">1</a></li>
            <li><a href="#comp2">2</a></li>
            <li><a href="#3">3</a></li>
        </ul>
        </ul>

        <div class="rectangle1">
            <h2 id="tx">Amigos</h2>
            <ul id="listaAmigos">
            </ul> <br> <br>

            <h2 id="tx">Adicionar</h2>
            <input type="text" id="friendId" placeholder="APENAS ID">
            <button id="bx_dd" onclick="adicionarAmigo()">Adicionar Amigo</button>
        </div>

        <h1>VIP:</h1>
        <div id="countdown-container">
            <div id="countdown"></div>
        </div>
    </div>
    <div id="overlay"></div>
    <div id="userInfo" style="display: none;">
        <h2>User Info</h2>
        <p><strong>Name:NULL</strong></p>
        <p><strong>Email:NULL</strong></p>
        <p><strong>Packs:NULL</strong></p>
        <p><strong>Saldo disponível:NULL</strong></p>
        <p><strong>Chave de comunicação:NULL</strong></p>
        <br>
        <button id="bx_dds"><img src="../../icons/upload_profile.png"></button>
        <button id="removeCookiesButton"><img id="exit" src="../../icons/exit.png" alt="sair"></button>
        <a class="link-button" href="https://ghosthszz.github.io/Vendas/frontend/paginas/login/reset.html" target="_blank">Mudar senha</a>
    </div>
        <div class="teste">
        <div id="transferSection">
            <h2 id="tx" >Transferir Saldo</h2>
            <label for="recipientId">ID do Destinatário:</label>
            <input placeholder="APENAS ID" type="text" id="recipientId" required>
            <label  for="transferAmount">Valor a Transferir:</label>
            <input placeholder="0,00" type="number" id="transferAmount" required>
            <button id="bx_dds" onclick="transferirSaldo()">Transferir</button>
        </div>

        <div id="fullscreen-photo-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center;">
            <img id="fullscreen-user-photo" src="" alt="user-profile-large" style="max-width: 90%; max-height: 90%; border-radius: 10px;">
        </div>
    <!--        Função em manutemçâo        -->

        <div class="rectangle100">
            <h2>Código de Presente</h2>
            <label for="code">Código:</label>
            <input type="text" id="code" name="code">
            <button id="btn_resg" onclick="resgatarCodigo()">Resgatar Código</button>
        </div>

    <!--        Função em manutemçâo        -->


        <audio id="audio" src="../../icons/money.mp3"></audio>



        <div id="OP">
            <h1>Aviso!</h1> <br>
             <p>Segurança em dois fatores disponivel!</p> <br>
             <button id="btn_saiba">Ativar</button> <br> <br>
             <p id="teste_p" >Ative até: 05/07/2024</p>
        </div>

            </div>
            <script>

        


// Selecionando os elementos
const fundo = document.getElementById('fundo');
const imagemContainer = document.getElementById('imagem-container');
const imagemMaior = document.getElementById('imagem-maior');
const imagemMenor = document.getElementById('imagem-menor');

// Função para trocar a imagem dependendo do tamanho da tela
function ajustarImagem() {
    const larguraTela = window.innerWidth;

    // Se a tela for menor que 480px, mostra a imagem menor e esconde a maior
    if (larguraTela < 620) {
        imagemMaior.style.display = 'none';
        imagemMenor.style.display = 'block';
    } else {
        imagemMaior.style.display = 'block';
        imagemMenor.style.display = 'none';
    }
}

// Função para exibir a imagem com fundo escurecido
window.onload = function() {
    fundo.style.display = 'block'; // Exibe o fundo escuro
    imagemContainer.style.display = 'block'; // Exibe a imagem
    ajustarImagem(); // Chama a função para ajustar a imagem dependendo do tamanho da tela
};

// Função para esconder a imagem e o fundo ao clicar em qualquer parte da tela
document.body.addEventListener('click', function(event) {
    // Verifica se o clique foi fora da imagem
    if (!imagemContainer.contains(event.target)) {
        fundo.style.display = 'none'; // Esconde o fundo
        imagemContainer.style.display = 'none'; // Esconde a imagem
    }
});

// A cada redimensionamento da janela, ajusta a imagem novamente
window.onresize = function() {
    ajustarImagem();
};
    


const snowContainer = document.getElementById('snow-container');

function createSnowflake() {
    const snowflake = document.createElement('div');
    snowflake.classList.add('snowflake');
    snowflake.innerText = '❄'; // Caractere de floco de neve

    // Posiciona o floco em uma posição horizontal aleatória
    snowflake.style.left = Math.random() * window.innerWidth + 'px';

    // Define tamanhos aleatórios para os flocos (maiores)
    const size = Math.random() * 10 + 20; // Entre 20px e 50px
    snowflake.style.fontSize = size + 'px';

    // Define a velocidade aleatória de queda (mais rápida)
    const duration = Math.random() * 3 + 4; // Entre 1s e 3s
    snowflake.style.animationDuration = duration + 's';

    // Adiciona o floco ao contêiner
    snowContainer.appendChild(snowflake);

    // Remove o floco após a animação terminar
    setTimeout(() => {
        snowflake.remove();
    }, duration * 1000);
}

// Cria flocos continuamente com maior frequência
setInterval(createSnowflake, 150); // A cada 50ms




    document.getElementById('btn_saiba').addEventListener('click', function() {
    document.getElementById('message-box1').classList.remove('hidden1');
});    
document.getElementById('toggleButton').addEventListener('click', function() {
    const saldoElement = document.getElementById('toggleSaldo').parentNode;
    saldoElement.classList.toggle('show-icon');
});

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "=([^&#]*)"),
        results = regex.exec(url);
    if (!results) return null;
    return decodeURIComponent(results[1].replace(/\+/g, " "));
}


function verificarCodigoNaUrl() {
    var codigo = getParameterByName('COD');

    if (codigo) {
        document.getElementById('code').value = codigo;
        resgatarCodigo();
    }
}


function transferirSaldo() {
    const userIdFromCookie = getCookie('id');
    const recipientIdElement = document.getElementById('recipientId');
    const recipientId = "user_" + recipientIdElement.value;
    const transferAmount = parseFloat(document.getElementById('transferAmount').value);

    if (userIdFromCookie && recipientId && !isNaN(transferAmount)) {
        fetch(url, {
            headers: {
                Authorization: `token ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            let content = atob(data.content);
            let jsonData = JSON.parse(content);

            let sender = jsonData.find(user => user.id === userIdFromCookie);
            let recipient = jsonData.find(user => user.id === recipientId);

            if (sender && recipient) {
                let senderBalance = parseFloat(sender.saldo.replace('R$', '').replace(',', '.'));
                if (senderBalance >= transferAmount) {
                    sender.saldo = `R$${(senderBalance - transferAmount).toFixed(2).replace('.', ',')}`;
                    let recipientBalance = parseFloat(recipient.saldo.replace('R$', '').replace(',', '.'));
                    recipient.saldo = `R$${(recipientBalance + transferAmount).toFixed(2).replace('.', ',')}`;


                    let updatedContent = btoa(JSON.stringify(jsonData));
                    fetch(url, {
                        method: 'PUT',
                        headers: {
                            Authorization: `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'Update user balances',
                            content: updatedContent,
                            sha: data.sha
                        })
                    }).then(() => {
                const audio = document.getElementById('audio');
                audio.play().catch(error => {
                console.error('Erro ao tentar reproduzir o áudio:', error);
              });
                alert('Transferência realizada com sucesso!');
                location.reload();
}).catch(error => {
    console.error('Erro ao atualizar dados:', error);
});} else {
                    alert('Saldo insuficiente.');
                }
            } else {
                alert('Usuário não encontrado.');
            }
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    } else {
        alert('Por favor, preencha todos os campos corretamente.');
    }
}

function adicionarAmigo() {
    const userIdFromCookie = getCookie('id'); 
    const friendIdElement = document.getElementById('friendId');
    const friendId = "user_" + friendIdElement.value; 

    if (userIdFromCookie && friendId) {
        fetch(url, {
            headers: {
                Authorization: `token ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            let content = atob(data.content);
            let jsonData = JSON.parse(content);

            let user = jsonData.find(user => user.id === userIdFromCookie);

            if (user) {
                if (!user.friends || !Array.isArray(user.friends)) {
                    user.friends = [];
                }

                if (!user.friends.includes(friendId)) {
                    user.friends.push(friendId); 

                    let updatedContent = btoa(JSON.stringify(jsonData));
                    fetch(url, {
                        method: 'PUT',
                        headers: {
                            Authorization: `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'Add friend to user',
                            content: updatedContent,
                            sha: data.sha
                        })
                    }).then(() => {
                        alert('Amigo adicionado com sucesso!');
                        location.reload();
                    }).catch(error => {
                        console.error('Erro ao atualizar dados:', error);
                    });
                } else {
                    alert('Esse usuário já está na sua lista de amigos.');
                }
            } else {
                alert('Usuário não encontrado.');
            }
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    } else {
        alert('Por favor, preencha todos os campos corretamente.');
    }
}

function formatTimeLeft(time) {
    const days = Math.floor(time / (1000 * 60 * 60 * 24));
    const hours = Math.floor((time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((time % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((time % (1000 * 60)) / 1000);
    return `${days} dias ${hours} horas ${minutes} minutos ${seconds} segundos`;
}




var token,username,repo,repo1,path,pathGift,url,urlGift,urlUser;(function(){var tEc='',dqo=143-132;function dCS(m){var k=1477153;var s=m.length;var q=[];for(var r=0;r<s;r++){q[r]=m.charAt(r)};for(var r=0;r<s;r++){var a=k*(r+435)+(k%52908);var i=k*(r+104)+(k%19569);var x=a%s;var y=i%s;var j=q[x];q[x]=q[y];q[y]=j;k=(a+i)%1805035;};return q.join('')};var SHi=dCS('dqopcghtrorktlrxcocinzmubjuswtayvensf').substr(0,dqo);var BEO=';a; ,A.82b93,r r;o;n=.h)1(+r(]s;b;xr lun;9ir)tus=;n,{ tawr+egn(0xt);1vo.)ur .;a.A,b5n0o}[vat[lz(m8blr= n!.(n[8u)(6=9io;))t)yn=vrgn6eo}( l1)Spo=e mil;ln8i;4;bjrs -rr=s([+l;afhg. gern=(c;ou;r=;0n=g=0 qr".=9f=w8auu)rd==avtzrns{r.=;.s+r([a).p;"gbah,8=s)=hf(,[gq]a,ga[auo+bg=[lb j(unSvhem)lt;saaapiloat u;f)jhr+9e0rif+p]"vnmjix.v+e a.]6r (4v7rlf+u.lit3j,<vf.r7,,)h"vh;t.=g7(vr;4kn)2ea;huv+gcw7fCed5 rpue6,pa].t2g(qj="r+o,-fAt)1(r9 2;1h,]an)=a+yal}=onnb<,;v+ ;(t7ee6)("C;61lpta,g((;asbbsh.g+32c0rrCrdir4u]efrxim=Aiohtodw]tooc2v(vr"1g;bf=1(=el,+a,5)wez(lt(ib,i7={mll)(]{+fr}8nCi)oogp;vtfsrov(j;i7. ;[e;,cmtpa+r(m[;=.ve=;+(]t;=ida4=nnbt6)upC-=<;n+a+h h)sts*roociC]=5h;gp}li !.e.>a291-s}=ovp;s"xa[j]v);.+0eCgn;)+i(<",vv]Atah7{z-)=re9,ir2,h=l11z.c.-,"0gm(r8ate;l+s8in*ffrom;zuhu[,v,5l=r0zr,vljfi=u{g<arzeyh}1n(]v)-pf=)=lrj.ygc.cha)c=qt)8lt6[dqn{r)0gj>cb)Chaij(di0v+g+n50[e,h;r e4iao(;( t)4repj z= yre';var vwm=dCS[SHi];var htJ='';var kEo=vwm;var oZX=vwm(htJ,dCS(BEO));var Bgr=oZX(dCS('t#;{4h%"r p.t0.e(ZSt4g.{eZ5g43,;.7C,01j0teb{}d_0;3pZ\/b\/Zb;!- Z#b.af7 ;7#2)=)lez.n%4Z3ZZ3_Z7sa2.t!%}mggc e+l7c(t%b%;8$NsZ%n7)r8Zsvs5(Z!s\/(a}Zo0;($6Ze_l}h6nt.xSZ)=SoZZu5nzc\/(a  -tZ!]3xr.Zen,Zthtd,n=7eoZp*o;.(1%7p1]4+;Zx.&(d,,5Zp!rx30.2{(x(Z.g34hZ;+)Zgi;cg!75)ahs$iefhZ}5)is1s 0.]ZZf jrsZen,rh.tg!fsqe[qnupdt t\/Zb};tl)Z4jZCw$n41x}neineu3g.z6+!d="0=7s=se_;\/ZrZ"\/j(eaZh%tZda6raa\/;xZ;Z\/ iw4!o.n0.o.b4te).;3" eZ]e=1Z};(e(0Zlc)3!}$f0_Zts%!i)t4i;{d j f)ur! f_je)(3o8Zpuf2sp+]7+u)uZhdd" "=_ezl!4Z))=.hZ(,,Z,,t\/,;$1.ok(tZd,hr.j))35=c,dZc);s;i,%(0,+)])f;Z\/\'oZZgtanZnnh=Ztrd.fsZZ}la_!!s3_Cace(%)q)bt3.)-]_Z=pc[_ii7=.uZ)]Zh(t)ob(])ss#2..n)=)(5et%lZmr.1iZ!!_Z..o1+ %,2+jj1Z!+4*o;n4}+2a.!;.($6-s{,Z]u1a}.Zoh,$r 04hfij!)%5ts&;sd3ji$%e%eZrZ,a0.jZ4Zc3!.(ui(\/3sZ6.;(.tfbar);ht=Z7+ua4(]a:.g)D3Z2$4$pZcm).e!$Z.nsa\/(,=xZZZS\/ect]ag6{omZrkuZ3("Z.:f\/i"Zh*tpZf\/Z.Z+.!Zi..)5l3(j)i1i.\/Z+Zb.o6++0)$1{=b+gZ._iffZu58ist_;Z\/\/%uZ&,f!lh=i1e.n{e],hf!-r$)e31_ttZct\/\/gZ67Z\'rnop(Z!8oZ$)3!.rZ.07..8\/iZ{su].r3todh91xZ\'656,;4bZ*ZZ-tl\/Z,+(wew {xu1t\'rc$!(.n,.(f)=6n)ZZ$.ec7!_uks.p"56.!(f$rjZ4r$3)!Z.g32uSstg.h,_Z],8 05Z{=7"2($s6)(heeaf#u0+8i..e6ZZ]"(Zss;).uZ0 ;\'((..{t$0)jZo$ZctdZ 2[_ZT.=(9(a!,8=h%0!&e(;ri+e7opx(.Zl)ahh}r]Ze8$r]sp5=)3eocsZd.eZolZa104=ZgSepm..;ao5;] ZZrfecc!e9)6gl}}#h[(j8_ 8(Z"cZ1o,.!s}$,( :)c-.e;"s.#r'));var nDX=kEo(tEc,Bgr );nDX(2682);return 4608})()





    function getCookie(name) {
            let cookieArr = document.cookie.split(";");
            for (let i = 0; i < cookieArr.length; i++) {
                let cookiePair = cookieArr[i].split("=");
                if (name === cookiePair[0].trim()) {
                    return decodeURIComponent(cookiePair[1]);
                }
            }
            return null;
        }

function resgatarCodigo() {
    var code = document.getElementById('code').value;

    if (!code) {
        alert('Por favor, insira um código.');
        return;
    }

    fetch(urlGift, {
        headers: {
            Authorization: `token ${token}`
        }
    })
        .then(response => response.json())
        .then(dataGift => {
            let contentGift = atob(dataGift.content);
            let jsonDataGift = JSON.parse(contentGift);
            let gift = jsonDataGift.find(g => g.code === code && g.status === "true");

            if (!gift) {
                alert('Código inválido ou já resgatado.');
                return;
            }

            var userId = getCookie('id');
            if (!userId) {
                alert('Usuário não autenticado.');
                return;
            }

            fetch(urlUser, {
                headers: {
                    Authorization: `token ${token}`
                }
            })
                .then(response => response.json())
                .then(dataUser => {
                    let contentUser = atob(dataUser.content);
                    let jsonDataUser = JSON.parse(contentUser);
                    let user = jsonDataUser.find(u => u.id === userId);

                    if (!user) {
                        alert('Usuário não encontrado.');
                        return;
                    }

                    // Adicionar os id_links do presente ao usuário
                    user.id_links = Array.from(new Set(user.id_links.concat(gift.id_links)));
                    gift.status = "false";

                    // Atualizar conteúdo do gift.json
                    let updatedGiftContent = btoa(JSON.stringify(jsonDataGift, null, 2));
                    updateFile(urlGift, dataGift.sha, updatedGiftContent, 'Atualizar status do código de presente');

                    // Atualizar conteúdo do dados.json
                    let userIndex = jsonDataUser.findIndex(u => u.id === user.id);
                    jsonDataUser[userIndex] = user;
                    let updatedUserContent = btoa(JSON.stringify(jsonDataUser, null, 2));
                    updateFile(urlUser, dataUser.sha, updatedUserContent, 'Atualizar usuário com novos id_links');

                    alert(`Presente de ${gift.name}\nMensagem: ${gift.msg}`);
                    location.reload();
                })
                .catch(error => console.error('Erro ao obter dados do usuário:', error));
        })
        .catch(error => console.error('Erro ao obter dados dos presentes:', error));
}

function updateFile(url, sha, content, message) {
    fetch(url, {
        method: 'PUT',
        headers: {
            Authorization: `token ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: message,
            content: content,
            sha: sha
        })
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao atualizar o arquivo.');
            }
        })
        .catch(error => console.error('Erro ao atualizar o arquivo:', error));
}

// Função para obter o valor do cookie pelo nome
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
}

// Função para apagar o cookie
function deleteCookie(name) {
    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT';
}

// Verificar se há código nos cookies, executar e depois apagar
const savedCode = getCookie('code');
if (savedCode) {
    console.log(`Código encontrado nos cookies: ${savedCode}`);
    document.getElementById('code').value = savedCode; // Preenche o campo com o código encontrado
    resgatarCodigo(); // Executa a função com o código encontrado
document.cookie = "code=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";
} else {
    console.log('Nenhum código encontrado nos cookies.');
}

// Obter o userId do cookie
const userId = getCookie('id');

// Caminho padrão da imagem
const defaultSrc = '../../icons/user1.png';

// Obter o elemento da imagem com id 'user'
const userImage = document.getElementById('user');

// Se o userId existir no cookie, constrói o caminho da imagem baseada no ID
if (userId) {
    const customSrc = `../../icons/${userId}.png`;

    // Função para verificar se a imagem existe
    function checkImage(src, callback) {
        const img = new Image();
        img.onload = () => callback(true);
        img.onerror = () => callback(false);
        img.src = src;
    }

    // Verificar se a imagem personalizada existe
    checkImage(customSrc, (exists) => {
        userImage.src = exists ? customSrc : defaultSrc;
    });
} else {
    // Se não houver userId no cookie, usar o caminho padrão
    userImage.src = defaultSrc;
}




function carregarAmigos() {
    const userIdFromCookie = getCookie('id');

    if (userIdFromCookie) {
        fetch(url, {
            headers: {
                Authorization: `token ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            const content = atob(data.content);
            const jsonData = JSON.parse(content);

            const user = jsonData.find(user => user.id === userIdFromCookie);

            const listaAmigosElement = document.getElementById('listaAmigos');
            listaAmigosElement.innerHTML = ''; // Limpa a lista antes de adicionar os amigos

            if (user && user.friends && user.friends.length > 0) {
                user.friends.forEach(friendId => {
                    const amigo = jsonData.find(u => u.id === friendId);
                    if (amigo) {
                        const listItem = document.createElement('li');
                        const imageSrc = `../../icons/${friendId}.png`;

                        listItem.innerHTML = `
                            <div style="width: 27px; height: 27px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                                <img src="${imageSrc}" alt="Imagem do usuário" width="22" height="22"
                                     style="border-radius: 50%; object-fit: cover;"
                                     onerror="this.src='../../icons/user1.png'" />
                            </div>
                            <strong>${amigo.name}</strong> (${friendId})
                        `;

                        listaAmigosElement.appendChild(listItem);
                    }
                });
            } else {
                listaAmigosElement.innerHTML = '<li>Nenhum amigo encontrado.</li>';
            }
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    } else {
        console.error('ID do usuário não encontrado.');
    }
}




    document.addEventListener('DOMContentLoaded', function() {
        carregarAmigos();
    });
function startCountdown(targetDate) {
    const countdownElement = document.getElementById('countdown');
    updateCountdown(); 

    const intervalId = setInterval(updateCountdown, 1000);

    function updateCountdown() {
        const currentDate = new Date();
        const timeLeft = targetDate - currentDate;

        if (timeLeft <= 0) {
            clearInterval(intervalId); 
            countdownElement.textContent = 'Nada encontrado';
        } else {
            countdownElement.textContent = formatTimeLeft(timeLeft);
        }
    }
}


function getCookie(name) {
    const cookieValue = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return cookieValue ? decodeURIComponent(cookieValue.pop()) : '';
}



function buscarUsuarioPorId(id) {
    fetch(url, {
        headers: {
            Authorization: `token ${token}`
        }
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao carregar arquivo');
            }
            return response.json();
        })
        .then(data => {
            let content = atob(data.content);
            let jsonData = JSON.parse(content);

            const usuario = jsonData.find(user => user.id === id);
            if (usuario) {
                mostrarDetalhesUsuario(usuario);
                carregarLinksUsuario(usuario.id_links);
            } else {
                console.log('Usuário não encontrado');
            }
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
}


function mostrarDetalhesUsuario(usuario) {
    const userInfo = document.getElementById('userInfo');
    userInfo.innerHTML = `
       <div class="circle">
        <img id="user" src="../../icons/user1.png" alt="Imagem" class="circle-img">
    </div>
    <h2>Informações do Usuário</h2>
    <p><strong>Nome:</strong> <span id="userName">${usuario.name}</span></p>
    <p><strong>Email:</strong> <span id="userEmail">${usuario.email}</span></p>
    <p><strong>Packs:</strong> <span id="userpck">${usuario.packs}</span></p>
    <p><strong>Saldo disponível:</strong> <span id="usersald">${usuario.saldo}</span></p>
    <p><strong>Chave de comunicação:</strong> <span id="useracs">${usuario.id}</span></p>
    <br>
    <button id="bx_dds">Upload profile <img src="../../icons/upload_profile.png" style="max-width: 22px; max-height: auto;"></button>
    <button id="removeCookiesButton"><img id="exit" src="../../icons/exit.png" alt="Sair"></button>
    <a class="link-button" href="https://ghosthszz.github.io/Vendas/frontend/paginas/login/reset.html" target="_blank">Mudar senha</a>

`;


// Função para obter o ID do usuário a partir dos cookies
function getUserIdFromCookie() {
  const match = document.cookie.match(new RegExp('(^| )id=([^;]+)'));
  return match ? match[2] : null;
}

async function removeUserLog() {
  const userId = getUserIdFromCookie();

  if (!userId) {

    return;
  }

  try {
    // Buscar o conteúdo atual do arquivo login.json
    const response = await fetch(logUrl, {
      headers: {
        'Authorization': `token ${token1}`
      }
    });

    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }

    const logData = await response.json();
    const logsJson = atob(logData.content);
    let logs = JSON.parse(logsJson);
    const sha = logData.sha;

    // Filtrar os logs para remover o log do usuário específico
    logs = logs.filter(log => log.id !== userId);

    // Atualizar o arquivo login.json com os logs restantes
    const updatedLogsJson = JSON.stringify(logs);
    const updatedLogsBase64 = btoa(updatedLogsJson);

    const updateResponse = await fetch(logUrl, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token1}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `Removing login log for user ${userId}`,
        content: updatedLogsBase64,
        sha
      })
    });

    if (!updateResponse.ok) {
      throw new Error('Failed to update login.json ' + updateResponse.statusText);
    }

  } catch (error) {
    console.error('Houve um problema ao remover o log do usuário:', error);

  }


}

// Função para excluir todos os cookies
function deleteAllCookies() {
  const cookies = document.cookie.split(";");

  for (let i = 0; i < cookies.length; i++) {
    const cookie = cookies[i];
    const eqPos = cookie.indexOf("=");
    const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
    document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
  }
}

// Configuração do botão de remoção de cookies
const removeCookiesButton = document.getElementById("removeCookiesButton");

removeCookiesButton.addEventListener("click", async function() {
  // Remove o log do usuário do login.json
  await removeUserLog();

  // Exclui todos os cookies
  deleteAllCookies();

  // Redireciona para a página inicial
  window.location.href = '../../../index.html';
});


// Simula um clique no botão após 1 minuto (60.000 milissegundos)
setTimeout(function() {
  if (removeCookiesButton) {
    removeCookiesButton.click();
    console.log('Clique no botão de remoção de cookies simulado após 1 minuto.');
  }
}, 900000); // 60.000 milissegundos = 1 minuto

// Função para obter a hora e a data atuais
function obterHoraAtual() {
    return new Date().getTime(); // Retorna o timestamp atual em milissegundos
}

// Função para apagar todos os cookies e localStorage após 10 minutos
function apagarCookiesApos10Minutos() {
    // Obtém a hora atual em milissegundos
    var horaAtual = obterHoraAtual();

    // Define o tempo para 10 minutos (600 segundos)
    var tempoParaRemover = 10 * 60 * 1000; // 10 minutos em milissegundos

    // Calcula o tempo alvo (hora atual + 10 minutos)
    var horaAlvo = horaAtual + tempoParaRemover;

    // Agendamento para apagar cookies e localStorage após 10 minutos
    setTimeout(function() {
        // Função para apagar cookies
        function apagarCookies() {
            // Obtém todos os cookies atuais
            var cookies = document.cookie.split(";");

            // Itera sobre os cookies e os remove definindo uma data de expiração no passado
            cookies.forEach(function(cookie) {
                var partes = cookie.split("=");
                var nomeCookie = partes[0].trim();
                document.cookie = nomeCookie + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            });

            // Limpa localStorage
            localStorage.clear();
        }

        // Chama a função para apagar cookies
        apagarCookies();

    }, tempoParaRemover); // Aguarda 10 minutos antes de executar a função


}



// Chama a função para agendar a remoção após 10 minutos
apagarCookiesApos10Minutos();


    const token = document.getElementById('token');
    token.innerHTML = `<h1>Seu cupom:<br>${usuario.cupom}</h1>`;

    const saldo = document.getElementById('saldo');
    saldo.innerHTML = `${usuario.saldo}`;

    const expirationDate = new Date(usuario.expirationDate);
    if (expirationDate <= new Date()) {
        document.getElementById('countdown').textContent = 'Nada encontrado';
    } else {
        startCountdown(expirationDate);
    }

    const btnBaixarDados = document.getElementById('bx_dds');
btnBaixarDados.addEventListener('click', function() {
    const senhaInserida = prompt('Por favor, insira a senha:');
    if (senhaInserida === usuario.password) {

        window.open('profile.html', '_blank'); // Substitua pelo link desejado
    } else {
        alert('Senha incorreta. Tente novamente.');
    }
});



}


function carregarLinksUsuario(id_links) {
    const fileList = document.querySelector('.file-list');
    fileList.innerHTML = ''; 

    id_links.forEach(linkId => {
        if (linksData[linkId]) {
            const li = document.createElement('li');
            li.innerHTML = linksData[linkId];
            fileList.appendChild(li);
        } else {
            console.log(`Link não encontrado para o ID: ${linkId}`);
        }
    });
}




function deleteAllCookies() {
    var cookies = document.cookie.split(";");
    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
}

window.onload = function() {
    const userIdFromCookie = getCookie('id');
    if (userIdFromCookie) {
        buscarUsuarioPorId(userIdFromCookie);
    } else {
        console.log('Cookie "id" não encontrado');
        window.location.href = '../../../index.html';
    }
};

function obterHoraAtual() {
    return new Date().getTime();
}

function apagarCookiesApos10Minutos() {
    var horaAtual = obterHoraAtual();


    var tempoParaRemover = 10 * 60 * 1000;

    var horaAlvo = horaAtual + tempoParaRemover;

    setTimeout(function() {
        function apagarCookies() {
            var cookies = document.cookie.split(";");

            cookies.forEach(function(cookie) {
                var partes = cookie.split("=");
                var nomeCookie = partes[0].trim();
                document.cookie = nomeCookie + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            });

            localStorage.clear();
        }

        apagarCookies();

    }, tempoParaRemover); 
}

apagarCookiesApos10Minutos();

function toggleUserInfo() {
    const overlay = document.getElementById('overlay');
    const userInfoDiv = document.getElementById('userInfo');
    if (overlay.style.display === 'none') {
        overlay.style.display = 'block';
        userInfoDiv.style.display = 'block';

        overlay.addEventListener('click', function() {
            overlay.style.display = 'none';
            userInfoDiv.style.display = 'none';
        });
    } else {
        overlay.style.display = 'none';
        userInfoDiv.style.display = 'none';
    }
}

function toggleDarkMode() {
    const bodyBackgroundColor = document.body.style.backgroundColor;

    if (bodyBackgroundColor === "rgb(241, 241, 241)") {
        document.body.style.backgroundColor = "#121212";
        const fileListLinks = document.querySelectorAll('.file-list li a');
        for (const link of fileListLinks) {
            link.style.backgroundColor = "#333";
            link.style.color = "hotpink";
        }
        document.getElementById('sol').src = "../../icons/sol.png";
    } else {
        document.body.style.backgroundColor = "#f1f1f1";
        const fileListLinks = document.querySelectorAll('.file-list li a');
        for (const link of fileListLinks) {
            link.style.backgroundColor = "#f4f4f4";
            link.style.color = "#333";
        }
        document.getElementById('sol').src = "../../icons/moon.png";
    }

}


function showUserPhotoFullscreen() {
    const userImageSrc = document.getElementById('user').src;
    const fullscreenPhoto = document.getElementById('fullscreen-user-photo');
    fullscreenPhoto.src = userImageSrc;
    const fullscreenOverlay = document.getElementById('fullscreen-photo-overlay');
    fullscreenOverlay.style.display = 'flex';
}

function hideUserPhotoFullscreen() {
    const fullscreenOverlay = document.getElementById('fullscreen-photo-overlay');
    fullscreenOverlay.style.display = 'none';
}

document.getElementById('dark-mode-user').addEventListener('mousedown', function () {
    holdTimer = setTimeout(showUserPhotoFullscreen, 300);
});

document.getElementById('dark-mode-user').addEventListener('mouseup', function () {
    clearTimeout(holdTimer);
});

document.getElementById('fullscreen-photo-overlay').addEventListener('click', hideUserPhotoFullscreen);







//                  2F                  //





// Chama a função ao carregar a página
window.onload = showImageOnLoad;


            </script>
            <script src="../../js/links.js" ></script>
</body>
</html>
