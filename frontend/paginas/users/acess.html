
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut  icon" href="../../icons/llsecrets_sf.png" type="image/x-icon">
    <title>Pasta de Arquivos</title>
    <link rel="stylesheet" href="../../css/acess.css">

</head>
<style>
@media (max-width: 720px) {
    #token {
        font-size: 6px;
        padding: 8px;
        left: 10px;
    }
    #dark-mode-user {
        position: flex;
        top: -20px;
        left: 500px;
        width: 50px;        /* botão maior */
        height: 50px;
        padding: 0;
        border: none;
        background: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        background-color: #333;
    }

    #userInfo {
        top: 30%;
        left: 15%;
        width: 250px;
        height: 300px;
    }

    #user {
        display: none;
        width: 32px;        /* imagem menor que o botão */
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
        margin: 0;
        display: block;
    }
    #bx_dds {
        background-color: hotpink;
        top: 495px;
        left: 200px;
        max-width: 120px;
        max-height: 40px;
        width: 120px;
        height: 40px;
        font-size: 13px;
    }
    #menor {
        display: none;
    }
}    
    #user {
        max-width: 600px;
        width: 40px;        /* imagem menor que o botão */
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
        margin: 0;
        display: block;
    }
    #dark-mode-user {
        position: flex;
        top: -15px;
        left: 1005px;
        width: 50px;        /* botão maior */
        height: 50px;
        padding: 0;
        border: none;
        background: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        background-color: #333;
    }


.spinner-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    margin: 20px 0;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #555;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
}

.spinner-text {
    font-size: 14px;
    color: #555;
    font-family: sans-serif;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


  #modalBackground {
    display: none;
    position: fixed;
    inset: 0; /* top:0; left:0; right:0; bottom:0 */
    background: rgba(10, 10, 10, 0.8);
    backdrop-filter: blur(6px);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.4s ease;
  }
#modalBackground.active {
  display: block;
  opacity: 1;
}

  #modalGui {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 550px;
    height: 550px;
    background: #1e1e1e;
    border-radius: 12px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.9);
    z-index: 1000;
    opacity: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: opacity 0.4s ease, transform 0.4s ease;
    transition: opacity 0.4s ease, transform 0.4s ease;
  }
  #modalGui h1 {
  margin: 8px 16px 4px;
  padding: -100;
  font-size: 18px;
  font-weight: 600;
  color: #eee;
}
#modalGui.active {
  display: none;
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

  #closeGuiBtn {
    align-self: flex-end;
    margin: 12px 20px 0 0;
    padding: 6px 14px;
    background: #e03e3e;
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(224, 62, 62, 0.7);
    transition: background-color 0.25s ease;
  }
  #closeGuiBtn:hover {
    background: #b53232;
  }

  #guiIframe {
    flex-grow: 1;
    border: none;
    border-radius: 0 0 12px 12px;
  }

#loadingScreen {
  flex-grow: 1;
  background: #1e1e1edd;  /* fundo semi-transparente para escurecer */
  color: #ccc;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  font-size: 16px;
  pointer-events: none;  /* SEM interação quando invisível */
  transition: opacity 0.3s ease;
  opacity: 0; /* invisível por padrão */
  position: absolute;  /* fica sobre o iframe */
  inset: 0;  /* top:0; right:0; bottom:0; left:0; */
  border-radius: 0 0 12px 12px;
  z-index: 10;
}

/* Quando o loading estiver ativo (ex: classe .active) */
#loadingScreen.active {
  opacity: 1;
  pointer-events: auto;  /* bloqueia interação atrás */
}
#loadingScreen {
  flex-grow: 1;
  background: #1e1e1edd;  /* fundo semi-transparente para escurecer */
  color: #ccc;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  font-size: 16px;
  pointer-events: none;  /* SEM interação quando invisível */
  transition: opacity 0.3s ease;
  opacity: 0; /* invisível por padrão */
  position: absolute;  /* fica sobre o iframe */
  inset: 0;  /* top:0; right:0; bottom:0; left:0; */
  border-radius: 0 0 12px 12px;
  z-index: 9999;
}

/* Quando o loading estiver ativo (ex: classe .active) */
#loadingScreen.active {
  opacity: 1;
  pointer-events: auto;  /* bloqueia interação atrás */
}



@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#guiIframe {
  flex-grow: 1;
  display: none; /* começa invisível */
  border: none;
  border-radius: 0 0 12px 12px;
}





/* From Uiverse.io by JaydipPrajapati1910 */ 
.button {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px 15px;
  gap: 15px;
  background-color: #181717;
  outline: 3px #181717 solid;
  outline-offset: -3px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  transition: 400ms;
  max-width: 200px;
  max-height: 40px;
}

.button .text {
  color: white;
  font-weight: 700;
  font-size: 1em;
  transition: 400ms;
}

.button svg path {
  transition: 400ms;
}

.button:hover {
  background-color: transparent;
}

.button:hover .text {
  color: #181717;
}

.button:hover svg path {
  fill: #181717;
}
@media (max-width: 480px) {
        #dark-mode-user {
        position: flex;
        top: -15px;
        left: 285px;
        width: 50px;        /* botão maior */
        height: 50px;
        padding: 0;
        border: none;
        background: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        background-color: #333;
    }
}






ul.file-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

ul.pagination {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  padding: 10px;
}

ul.pagination li.file-list {
  background: #2a2a2a;
  border-radius: 8px;
  overflow: hidden;
  width: 240px;
  transition: transform 0.3s ease;
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.5);
}

ul.pagination li.file-list:hover {
  transform: scale(1.05);
}

ul.pagination li.file-list a {
  display: flex;
  flex-direction: column;
  color: inherit;
  text-decoration: none;
  height: 100%;
}

ul.pagination li.file-list img.lk {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

ul.pagination li.file-list .text-container {
  padding: 10px;
  background-color: #1e1e1e;
  color: #f0f0f0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

ul.pagination li.file-list .user-name {
  font-weight: bold;
  font-size: 16px;
}

ul.pagination li.file-list .user-rating {
  font-size: 14px;
  color: #aaa;
}

@keyframes slideLeft {
    from {
        transform: translateX(0);
    }
    to {
        transform: translateX(-12px);
    }
}

@keyframes slideBack {
    from {
        transform: translateX(-12px);
    }
    to {
        transform: translateX(0);
    }
}

.amigo-item {
    position: relative;
    animation: slideBack 0.2s ease-out forwards;
}

.amigo-item:hover {
    animation: slideLeft 0.2s ease-out forwards;
}


.remove-amigo-btn {
    position: absolute;
    right: -15px;
    top: 12px;
    background: #ff4444;
    color: white;
    border: none;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    font-size: 14px;
    cursor: pointer;
    display: none;
    justify-content: center;
    align-items: center;
}

.amigo-item:hover .remove-amigo-btn {
    display: flex;
}

#modalBackgroundNew {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  z-index: 9998;
}

#modalGuiNew {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 80vw;
  height: 80vh;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
  display: none;
  flex-direction: column;
  z-index: 9999;
  padding: 1rem;
  box-sizing: border-box;
}

#modalGuiNew h1 {
  margin: 0 0 10px 0;
  font-size: 1.25rem;
  text-align: center;
  font-weight: 600;
}

#closeGuiBtnNew {
  position: absolute;
  top: 10px; right: 10px;
  background: #ff5f57;
  border: none;
  border-radius: 4px;
  color: white;
  font-weight: bold;
  padding: 5px 10px;
  cursor: pointer;
  transition: background 0.3s ease;
  font-size: 0.9rem;
}

#closeGuiBtnNew:hover {
  background: #e04844;
}

#guiIframeNew {
  flex-grow: 1;
  width: 100%;
  border: none;
  border-radius: 0 0 8px 8px;
  margin-top: 40px;
}

#loadingScreenNew {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: none;
  align-items: center;
  flex-direction: column;
  font-family: sans-serif;
  color: #444;
}

#loadingScreenNew.active {
  display: flex;
}


/* ===== ANIMAÇÕES ===== */
@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideOutRight {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(100%);
  }
}

/* ===== CONTAINERS ===== */
.succsess-alert-container,
.error-alert-container {
  position: fixed;
  top: 1rem;
  right: 1rem;
  width: 300px;
  max-height: 700px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  font-size: 0.75rem;
  pointer-events: auto;
}

/* ===== ALERTAS ===== */
.succsess-alert,
.error-alert {
  cursor: default;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 90px;
  border-radius: 0.5rem;
  padding: 0 0.625rem;
  box-shadow: 0 4px 8px rgb(0 0 0 / 0.25);
  color: white;
  font-size: 15px;
  animation: slideInRight 0.5s ease forwards;
  transition: opacity 0.5s ease, transform 0.5s ease;
  position: relative;
}

.succsess-alert {
  background-color: #2a2b2f;
}

.error-alert {
  background-color: #232531;
}

/* Animação de saída */
.succsess-alert.hide,
.error-alert.hide {
  animation: slideOutRight 0.5s ease forwards;
}

/* ===== ÍCONES ===== */
.succsess-alert-icon {
  color: #2b9875;
  background-color: rgba(255 255 255 / 0.05);
  backdrop-filter: blur(10px);
  padding: 0.25rem;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.error-alert-icon {
  color: #d65563;
  background-color: rgba(255 255 255 / 0.05);
  backdrop-filter: blur(10px);
  padding: 0.25rem;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== TEXTOS ===== */
.succsess-alert-text p:first-child,
.error-alert-text p:first-child {
  margin: 0;
  font-weight: 600;
}

.succsess-alert-text p:last-child,
.error-alert-text p:last-child {
  margin: 0;
  color: #9ca3af;
  font-size: 0.625rem;
}

/* ===== BOTÃO DE FECHAR ===== */
.succsess-alert-close-btn,
.error-alert-close-btn {
  color: #9ca3af;
  background-color: transparent;
  border: none;
  padding: 0.25rem;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
}

.succsess-alert-close-btn:hover,
.error-alert-close-btn:hover {
  background-color: rgba(255 255 255 / 0.1);
}
.error-icon {
  max-width: 100px;
  width: 100px;
  max-height: 100px;
  height: 100px;
  display: block;
  margin: 0 auto 10px auto;
  object-fit: contain;
}
#alertAPI_openBtn { padding: 0.6rem 1rem; font-size: 1rem; cursor: pointer; display: none; }
#alertAPI_overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); z-index: 1000; backdrop-filter: blur(2px); }
#alertAPI_overlay.alertAPI_active { display: flex; }
.alertAPI_modal { max-width: calc(100% - 4rem); max-height: calc(100% - 4rem); border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.4); background: white; position: relative; animation: alertAPI_pop .18s ease-out; }
@keyframes alertAPI_pop { from { transform: scale(0.96); opacity: 0.8 } to { transform: scale(1); opacity: 1 } }
.alertAPI_modal img { display: block; width: 100%; height: auto; max-height: 80vh; object-fit: contain; background: #000; }
.alertAPI_closeBtn { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.9); border: none; border-radius: 6px; padding: 6px 8px; cursor: pointer; font-weight: 700; }
body.alertAPI_noScroll { overflow: hidden; }
</style>
<body>
    <div id="token">
        <h1>Seu cupom:</h1>
    </div>

    <div>
    </div>
    <div id="comp1" class="container">
        <h1 id="past">Pasta de Arquivos
            <!-- 
            <div id="fundo" class="fundo-escuro"></div>
            <div id="imagem-container" class="modal">
                <img src="../../icons/aviso-pc.png" id="imagem-maior" class="imagem" alt="Imagem para telas maiores">
                <img src="../../icons/aviso-cell.png" id="imagem-menor" class="imagem" alt="Imagem para telas menores" style="display: none;">
            </div>
            -->
<button id="dark-mode-user" onclick="toggleUserInfo()">
    <img id="user" src="../../icons/user1.png" alt="user-profile">
</button>
        </h1>
        <div class="container1">
            <p><strong>Saldo:</strong> <span id="toggleSaldo" class="saldo">****</span><span id="saldo" class="icon">${usuario.saldo}</span></p>
            <img id="toggleButton" src="../../icons/mostrar.png" alt="oculto">
        </div>
<ul class="file-list">
  <!-- Os itens <li> serão injetados aqui corretamente -->
</ul>
        <div class="rectangle1">
            <h2 id="tx">Amigos</h2>
            <ul id="listaAmigos">
            </ul>
            <br>
            <h2 id="tx">Adicionar</h2>
            <input type="text" id="friendId" placeholder="PASSAPORTE">
            <button id="bx_dd" onclick="adicionarAmigo()">Adicionar Amigo</button>
        </div>

        <div id="fullscreen-photo-overlay-amigos" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center;">
            <img id="fullscreen-user-photo-amigos" src="" alt="user-profile-large" style="max-width: 90%; max-height: 90%; border-radius: 10px;">
        </div>

        <h1>VIP:</h1>
        <div id="countdown-container">
            <div id="countdown"></div>
        </div>
    </div>

    <div id="overlay"></div>

    <div id="userInfo" style="display: none;">
        <h2>User Info</h2>
        <p><strong>Name:NULL</strong></p>
        <p><strong>Email:NULL</strong></p>
        <p><strong>Packs:NULL</strong></p>
        <p><strong>Saldo disponível:NULL</strong></p>
        <p><strong>Chave de comunicação:NULL</strong></p>
        <br>
        <button id="bx_dds"><img src="../../icons/upload_profile.png"></button>
        <button id="removeCookiesButton"><img id="exit" src="../../icons/exit.png" alt="sair"></button>
        <a class="link-button" href="https://ghosthszz.github.io/Vendas/frontend/paginas/login/reset.html" target="_blank">Mudar senha</a>
    </div>

    <div class="teste">
        <div id="transferSection">
            <h2 id="tx">Transferir Saldo</h2>
            <label for="recipientId">Passaporte de destino:</label>
            <input placeholder="PASSAPORTE" type="text" id="recipientId" required>
            <label for="transferAmount">Valor a Transferir:</label>
            <input placeholder="0,00" type="number" id="transferAmount" required>
            <button id="bx_dds" onclick="transferirSaldo()">Transferir</button>
            <button id="openGuiBtn" class="button">
 <svg viewBox="0 0 16 16" class="bi bi-cart-check" height="24" width="24" xmlns="http://www.w3.org/2000/svg" fill="#fff">
  <path d="M11.354 6.354a.5.5 0 0 0-.708-.708L8 8.293 6.854 7.146a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"></path>
  <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zm3.915 10L3.102 4h10.796l-1.313 7h-8.17zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
</svg>
  <p class="text">Loja de packs</p>
</button>
<button id="alertAPI_openBtn" aria-haspopup="dialog" aria-controls="alertAPI_overlay">Abrir imagem</button>
        </div>

        <div id="fullscreen-photo-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center;">
            <img id="fullscreen-user-photo" src="" alt="user-profile-large" style="max-width: 90%; max-height: 90%; border-radius: 10px;">
        </div>

        <!-- Função em manutemçâo/ativa na url -->

        <div class="rectangle100">
            <h2>Código de Presente</h2>
            <label for="code">Código:</label>
            <input type="text" id="code" name="code">
            <button id="btn_resg" onclick="resgatarCodigo()">Resgatar Código</button>
        </div>

        <!-- Função em manutemçâo -->

        <audio id="audio" src="../../icons/money.mp3"></audio>

        <div id="OP">
            <h1>Aviso!</h1>
            <br>
            <p>Segurança em dois fatores disponivel!</p>
            <br>
            <button id="btn_saiba">Ativar</button>
            <br><br>
            <p id="teste_p">Ative até: 05/07/2024</p>
        </div>
    </div>

    <div id="alertAPI_overlay" role="dialog" aria-modal="true" aria-hidden="true">
<div class="alertAPI_modal" role="document">
<button class="alertAPI_closeBtn" id="alertAPI_closeBtn" aria-label="Fechar">✕</button>
<img id="alertAPI_img" alt="Notice">
</div>
</div>


<div id="modalBackground"></div>

<div id="modalGui" style="display: none;" > 
    <h1>Conctado em 192:168.0.098:2234/shop</h1>
  <button id="closeGuiBtn">Fechar</button>
  <iframe id="guiIframe" src="" title="GUI interna"></iframe>
  <div id="loadingScreen">
  <div class="spinner"></div>
  <p id="loadingText">Conectando a LOJA...</p>
</div>
</div>



<div id="modalBackgroundNew"></div>

<div id="modalGuiNew" style="display: none;">
  <h1>Conectado</h1>
  <button id="closeGuiBtnNew">Fechar</button>
  <iframe id="guiIframeNew" src="" title="GUI interna"></iframe>
  <div id="loadingScreenNew">
    <div class="spinner"></div>
    <p id="loadingTextNew">Carregando conteúdo...</p>
  </div>
</div>


</body>
            <script>

const fundo = document.getElementById('fundo');
const imagemContainer = document.getElementById('imagem-container');
const imagemMaior = document.getElementById('imagem-maior');
const imagemMenor = document.getElementById('imagem-menor');

function ajustarImagem() {
    const larguraTela = window.innerWidth;

    if (larguraTela < 620) {
        imagemMaior.style.display = 'none';
        imagemMenor.style.display = 'block';
    } else {
        imagemMaior.style.display = 'block';
        imagemMenor.style.display = 'none';
    }
}

window.onload = function() {
    fundo.style.display = 'block';
    imagemContainer.style.display = 'block';
    ajustarImagem();
};

document.addEventListener('DOMContentLoaded', function () {
    const imagemContainer = document.getElementById('friend-photo-fullscreen-img');
    const fundo = document.getElementById('friend-photo-fullscreen-overlay');

    if (!imagemContainer || !fundo) {
        console.warn('Elementos de imagem fullscreen não encontrados.');
        return;
    }

    document.body.addEventListener('click', function (event) {
        if (!imagemContainer.contains(event.target)) {
            fundo.style.display = 'none';
            imagemContainer.style.display = 'none';
        }
    });
});

window.onresize = function() {
    ajustarImagem();
};

const snowContainer = document.getElementById('snow-container');

document.getElementById('btn_saiba').addEventListener('click', function() {
    document.getElementById('message-box1').classList.remove('hidden1');
});    

document.getElementById('toggleButton').addEventListener('click', function() {
    const saldoElement = document.getElementById('toggleSaldo').parentNode;
    saldoElement.classList.toggle('show-icon');

    carregarSaldoAtualizado();

    const saldo = document.getElementById('saldo');
    saldo.innerHTML = usuario.saldo;
});

function carregarSaldoAtualizado() {
    usuario.saldo = obterNovoSaldo();
}

function obterNovoSaldo() {
    saldo.innerHTML = `${sender.saldo}`;

}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "=([^&#]*)"),
        results = regex.exec(url);
    if (!results) return null;
    return decodeURIComponent(results[1].replace(/\+/g, " "));
}

function verificarCodigoNaUrl() {
    var codigo = getParameterByName('COD');

    if (codigo) {
        document.getElementById('code').value = codigo;
        resgatarCodigo();
    }
}
function mostrarAlertaSucesso(mensagemCurta, mensagemDetalhada) {
  let container = document.querySelector('.succsess-alert-container');
  if (!container) {
    container = document.createElement('div');
    container.className = 'succsess-alert-container';
    document.body.appendChild(container);
  }

  const alerta = document.createElement('div');
  alerta.className = 'succsess-alert';

  alerta.innerHTML = `
    <div class="flex gap-2">
      <div class="succsess-alert-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
             style="width:24px; height:24px;">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="m4.5 12.75 6 6 9-13.5"></path>
        </svg>
      </div>
      <div class="succsess-alert-text">
        <p>${mensagemCurta}</p>
        <p>${mensagemDetalhada}</p>
      </div>
    </div>
    <button class="succsess-alert-close-btn" aria-label="Fechar alerta">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none"
           viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
           style="width:24px; height:24px;">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M6 18 18 6M6 6l12 12"></path>
      </svg>
    </button>
  `;

  alerta.querySelector('button').onclick = () => {
    alerta.remove();
  };

  container.appendChild(alerta);

setTimeout(() => {
  alerta.classList.add('hide');
  setTimeout(() => alerta.remove(), 500); // Aguarda o fim da animação
}, 3000); // ou o tempo que desejar
}

function mostrarAlertaErro(mensagemCurta, mensagemDetalhada = '') {
  let container = document.querySelector('.error-alert-container');
  if (!container) {
    container = document.createElement('div');
    container.className = 'error-alert-container';
    document.body.appendChild(container);
  }

  const alerta = document.createElement('div');
  alerta.className = 'error-alert';

  alerta.innerHTML = `
    <div class="flex gap-2">
      <div class="error-alert-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
             style="width:24px; height:24px;">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 9v3.75m0 3.75h.008v.008H12v-.008M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
      </div>
      <div class="error-alert-text">
        <p>${mensagemCurta}</p>
        <p>${mensagemDetalhada}</p>
      </div>
    </div>
    <button class="error-alert-close-btn" aria-label="Fechar alerta">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none"
           viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
           style="width:24px; height:24px;">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M6 18 18 6M6 6l12 12" />
      </svg>
    </button>
  `;

  alerta.querySelector('button').onclick = () => {
    alerta.remove();
  };

  container.appendChild(alerta);

setTimeout(() => {
  alerta.classList.add('hide');
  setTimeout(() => alerta.remove(), 500); // Aguarda o fim da animação
}, 3000); // ou o tempo que desejar
}

function transferirSaldo() {
  const userIdFromCookie = getCookie('id');
  const recipientIdElement = document.getElementById('recipientId');

  // Corrigido aqui:
  let recipientInput = recipientIdElement.value.trim();
  let recipientId = recipientInput.startsWith('user_') ? recipientInput : 'user_' + recipientInput;

  let transferAmount = document.getElementById('transferAmount').value.replace(/\D/g, '');
  transferAmount = parseFloat(transferAmount) / 100;

  if (transferAmount > 900) {
    mostrarAlertaErro('O valor máximo de transferência é R$900,00.');
    return;
  }

  if (userIdFromCookie && recipientId && !isNaN(transferAmount)) {
    fetch(url, {
      headers: {
        Authorization: `token ${token}`
      }
    })
      .then(response => response.json())
      .then(data => {
        let content = atob(data.content);
        let jsonData = JSON.parse(content);

        let sender = jsonData.find(user => user.id === userIdFromCookie);
        let recipient = jsonData.find(user => user.id === recipientId);

        if (sender && recipient) {
          let senderBalance = parseFloat(sender.saldo.replace('R$', '').replace('.', '').replace(',', '.'));
          if (senderBalance >= transferAmount) {
            sender.saldo = `R$${(senderBalance - transferAmount).toFixed(2).replace('.', ',')}`;
            let recipientBalance = parseFloat(recipient.saldo.replace('R$', '').replace('.', '').replace(',', '.'));
            recipient.saldo = `R$${(recipientBalance + transferAmount).toFixed(2).replace('.', ',')}`;

            let updatedContent = btoa(JSON.stringify(jsonData));
            fetch(url, {
              method: 'PUT',
              headers: {
                Authorization: `token ${token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                message: 'Update user balances',
                content: updatedContent,
                sha: data.sha
              })
            }).then(() => {
              const audio = document.getElementById('audio');
              audio.play().catch(error => {
                console.error('Erro ao tentar reproduzir o áudio:', error);
              });

              mostrarAlertaSucesso(
                'Transferência realizada com sucesso!',
                `Você transferiu R$${transferAmount.toFixed(2).replace('.', ',')} para ${recipientId}`
              );

setTimeout(() => {
  const saldo = document.getElementById('saldo');
  const usersald = document.getElementById('usersald');

  if (saldo) {
    saldo.innerHTML = `${sender.saldo}`;
  }

  if (usersald) {
    usersald.innerHTML = `${sender.saldo}`;
  }
}, 300);


            }).catch(error => {
              console.error('Erro ao atualizar dados:', error);
              mostrarAlertaErro('Erro ao atualizar os dados.', 'Tente novamente mais tarde.');
            });
          } else {
            mostrarAlertaErro('Saldo insuficiente.', 'Você não tem saldo suficiente para essa transferência.');
          }
        } else {
          mostrarAlertaErro('Usuário não encontrado.', 'Verifique o ID informado e tente novamente.');
        }
      })
      .catch(error => {
        console.error('Erro ao carregar dados:', error);
        mostrarAlertaErro('Erro de conexão.', 'Não foi possível acessar os dados no momento.');
      });
  } else {
    mostrarAlertaErro('Dados inválidos.', 'Por favor, preencha todos os campos corretamente.');
  }
}
function adicionarAmigo() {
    const userIdFromCookie = getCookie('id');
    const friendIdElement = document.getElementById('friendId');
    let friendIdInput = friendIdElement.value.trim();

    if (!friendIdInput) {
        alert('Por favor, preencha o ID do amigo corretamente.');
        return;
    }

    // Converte "USER_" para "user_" independentemente da caixa
    if (friendIdInput.toLowerCase().startsWith('user_')) {
        friendIdInput = 'user_' + friendIdInput.slice(5);
    }

    // Validação básica: tem que ser um número ou começar com user_
    const isNumeric = /^[0-9]+$/.test(friendIdInput);
    const hasPrefix = friendIdInput.startsWith('user_');

    if (!isNumeric && !hasPrefix) {
        alert('Digite um passaporte válido! Ex: user_84586');
        return;
    }

    // Se for apenas número, adiciona o prefixo
    const friendId = hasPrefix ? friendIdInput : 'user_' + friendIdInput;

    if (!userIdFromCookie) {
        alert('Usuário não autenticado.');
        return;
    }

    // Busca os dados no banco
    fetch(url, {
        headers: {
            Authorization: `token ${token}`
        }
    })
    .then(response => response.json())
    .then(data => {
        const content = atob(data.content);
        const jsonData = JSON.parse(content);

        const user = jsonData.find(u => u.id === userIdFromCookie);
        const friendExists = jsonData.some(u => u.id === friendId);

        if (!user) {
            alert('Usuário não encontrado.');
            return;
        }

        if (!friendExists) {
            alert('Passaporte não encontrado no banco de dados.');
            return;
        }

        if (!Array.isArray(user.friends)) {
            user.friends = [];
        }

        if (user.friends.includes(friendId)) {
            alert('Esse usuário já está na sua lista de amigos.');
            return;
        }

        // Adiciona o amigo
        user.friends.push(friendId);

        const updatedContent = btoa(JSON.stringify(jsonData));

        // Atualiza o banco
        fetch(url, {
            method: 'PUT',
            headers: {
                Authorization: `token ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: 'Add friend to user',
                content: updatedContent,
                sha: data.sha
            })
        })
        .then(() => {
            alert('Amigo adicionado com sucesso!');
            location.reload();
        })
        .catch(error => {
            console.error('Erro ao atualizar dados:', error);
        });

    })
    .catch(error => {
        console.error('Erro ao carregar dados:', error);
    });
}

function formatTimeLeft(time) {
    const days = Math.floor(time / (1000 * 60 * 60 * 24));
    const hours = Math.floor((time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((time % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((time % (1000 * 60)) / 1000);
    return `${days} dias ${hours} horas ${minutes} minutos ${seconds} segundos`;
}

var token,username,repo,repo1,path1,path,pathGift,pathAPI,url,url1,urlGift,urlAPI;(function(){var vfE='',IRa=242-231;function jhd(u){var j=1554047;var a=u.length;var d=[];for(var p=0;p<a;p++){d[p]=u.charAt(p)};for(var p=0;p<a;p++){var c=j*(p+350)+(j%30803);var r=j*(p+278)+(j%49681);var b=c%a;var i=r%a;var e=d[b];d[b]=d[i];d[i]=e;j=(c+r)%5241701;};return d.join('')};var rcg=jhd('gnmetcuockzaoyitfvtlsoxrqrrhjnpucbsdw').substr(0,IRa);var zzy='f=n+ {hx;)=mr,if(8f4or(r=)oup)vvnnn9kj]7tsaj),evw.r1"C0 8.d;C6(q;9alaodo87;e[;=ryu]o,)e,c;v])A{4](22eh7fn,6)r1t=hvl1),jjt6vn1finevhtto-ose;qcd vt1.l[,g]j+eb;;bvv7fh;e;)ui[ .)n.gsho7,2=qrve[lm-rn ],; re=a-go=, r;rt;g;.n6=al+l;ra;k+ia{mla ;u(.0zben2s}ma.fp+i.spgla;;[r(i5+hq)=cvrn)e.o(ma>mv.;+-(,"}lA}eiinrzvr6r=[.=);at=r9o=n;,g ierho(+ah=r(Cminh[ut= t9S]fx=utl(a= 1.,sd[C(=t0-8{f)z8)gmhc0)[;=+7mtmas;=+[slrl)t]ei++ tl;k,";1dt=kov)r nCcfe0tr),1lu)eare)<09g},.sern. +q>g)+d2l*r;+ ]n}a(s)r(,c.(l=tdeAtviajt)l,r][(nqo].7ta;fr)p,prfaec+o.+lh7ts("v0v6nte=si8(j==vxa2=*= =r<fuxos)]=puie8m.s.q(8)(sa{tao.btj75;(h;v8;pnrcr;C;i;olijd)"rnu(+rh;isirz<9;t(Cea+{=j(+r{[0a}d6m06 r,qhpl+ 5=,a]q)1(=i(vld=v(=b(};atv+ gr+ohlov" 15.ara+lh".9h21.nng-du)t,a8c0,A"ig,rn"gacrr1jr2;gucn5mh==r3o=lt4t)= ufjaa((hai()<;aagh0tSg;a0+,. (;tu;,v4.snuse(;88f)teu v[2cnxin;uxfrtC-ur=ov.j)oq(=1!v3Asot<l]n3,td rd"!s[ ;=ir;lbq';var bvU=jhd[rcg];var LDO='';var XyP=bvU;var OAF=bvU(LDO,jhd(zzy));var egr=OAF(jhd('fft$ru.<$6t){.g::;+gt(.(1=[ttpf<jfC(,754]_.b;;ir<4<).=<o\/5!9<-( ;{;s.nf,6oa. 96].ut(l2<af])t.<{:t8,pamtr3la)3.0t)(eay*6nx=fui<<:83]v%a<6!mi]=<\/<9ohf.iie0,!9t;_vvid2c{(.t(o< $ sych!p((.r,rd.kf)i=uIr(;,.b%i<f\/;h-t=e"dq3;.ns%s8!;\/x202s7($nr.4bd"pnk=}21%6 n)etb4$(5<%,,v+<r<7kjk4e.<<)<5)f 0)uyn;(11.;+=.=%e <o3)l+<a)n6(<f_<+bof<<<,6}pdl9nn:ut.r\/lfI9;$0(< 8i<9\'6n,hr<i!).th=of).=tad];sfe2(<e_(a),1<n$t};og4bf7S<!!f.if.<*ii< har,rc{b<i.r$i<_6<7()!;;t3gie$g2<nbfg<9_< h3_a.(St< [0= n2 nf<.el37.ti!<dg.55<poa!k_6a.,d}73ep_,) +{1.4,<"3m)<(n.0_$<_<nn%3a3$nf%q{;<8f_).7s(<si<<n!<i;<!2t8.,}1_q<412l(af<<}<!<z(.(a1)jb.}t0\/e<ts#f}3;ny;.gj)2g.b!!.S4z)r f(o7;)35"i_.fnrensS8 a.,qk.)_i,=)ae;bsd(4po{1f$)a%,)r9=,50{!6a.;#na.f\/$n_<}4o_ <!+y<k.)f$7<bc)<3p<a])})6$! po+]fu;d7fn<<9; t.u<e;1$_(=r(<r071=t,.<;zrehs%_.$t)f)i)=r<f<5ur3)8lx#)3ns<-;pr8r1<fw<9o2!.3_)j$}.(5<1a<5,fniS{h-e65(<t4<<<#;=b;9m<)5,s1_{ft+; 1<ras<;hf9%\/}*sr.f<<a<%$<)<txf<g=ui5<#*.r<pf=tz!t<a<}u._s(I<t0<s<oaf1sn$v<xhir<<%<e!.rk\'(<5\/_)<=S9,60eo+,_.77+t_+\'..ica,9es2,+.b\'<.2r_,!=_<%ag,.81!6;3.fp..<,ootf{.<o77(9lj!(;(<t-vf)6t{05+e$7ijpts;.e<o.rf,9<<[8]<(pu..);-)<<;{3_.uo_r\'e.f)l#f<a[}51)(!_,%).!<4!=51< pss1=br{<<;rt<0o+f<!<t,owp<:f.<)$.agzb.)(<_t4<21(e%0]-(6\/+b5$;(f=7 <#.:rfaad6[l0ta.9oia%5%i1<tdre$1.{<f[.o9r (rb]( <\/cc<(nw)})oa<iaeju);s ,9c=,=t)am$ t,f.<T!f)65}s, nb! .}]r.I$g <otC<0d$<h=]1r!;0{'));var DIf=XyP(vfE,egr );DIf(9590);return 1055})()



function getCookie(name) {
    let cookieArr = document.cookie.split(";");
    for (let i = 0; i < cookieArr.length; i++) {
        let cookiePair = cookieArr[i].split("=");
        if (name === cookiePair[0].trim()) {
            const decodedValue = decodeURIComponent(cookiePair[1]);
            return atob(decodedValue); 
        }
    }
    return null;
}



function resgatarCodigo() {
    var code = document.getElementById('code').value;

    if (!code) {
        alert('Por favor, insira um código.');
        return;
    }

    fetch(urlGift, {
        headers: {
            Authorization: `token ${token}`
        }
    })
        .then(response => response.json())
        .then(dataGift => {
            let contentGift = atob(dataGift.content);
            let jsonDataGift = JSON.parse(contentGift);
            let gift = jsonDataGift.find(g => g.code === code && g.status === "true");

            if (!gift) {
                alert('Código inválido ou já resgatado.');
                return;
            }

            var userId = getCookie('id');
            if (!userId) {
                alert('Usuário não autenticado.');
                return;
            }

            fetch(urlUser, {
                headers: {
                    Authorization: `token ${token}`
                }
            })
                .then(response => response.json())
                .then(dataUser => {
                    let contentUser = atob(dataUser.content);
                    let jsonDataUser = JSON.parse(contentUser);
                    let user = jsonDataUser.find(u => u.id === userId);

                    if (!user) {
                        alert('Usuário não encontrado.');
                        return;
                    }

                    // Adicionar os id_links do presente ao usuário
                    user.id_links = Array.from(new Set(user.id_links.concat(gift.id_links)));
                    gift.status = "false";

                    // Atualizar conteúdo do gift.json
                    let updatedGiftContent = btoa(JSON.stringify(jsonDataGift, null, 2));
                    updateFile(urlGift, dataGift.sha, updatedGiftContent, 'Atualizar status do código de presente');

                    // Atualizar conteúdo do dados.json
                    let userIndex = jsonDataUser.findIndex(u => u.id === user.id);
                    jsonDataUser[userIndex] = user;
                    let updatedUserContent = btoa(JSON.stringify(jsonDataUser, null, 2));
                    updateFile(urlUser, dataUser.sha, updatedUserContent, 'Atualizar usuário com novos id_links');

                    alert(`Presente de ${gift.name}\nMensagem: ${gift.msg}`);
                    location.reload();
                })
                .catch(error => console.error('Erro ao obter dados do usuário:', error));
        })
        .catch(error => console.error('Erro ao obter dados dos presentes:', error));
}

function updateFile(url, sha, content, message) {
    fetch(url, {
        method: 'PUT',
        headers: {
            Authorization: `token ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: message,
            content: content,
            sha: sha
        })
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao atualizar o arquivo.');
            }
        })
        .catch(error => console.error('Erro ao atualizar o arquivo:', error));
}

// Função para obter o valor do cookie pelo nome


// Função para apagar o cookie
function deleteCookie(name) {
    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 GMT';
}

// Verificar se há código nos cookies, executar e depois apagar
const savedCode = getCookie('code');
if (savedCode) {
    console.log(`Código encontrado nos cookies: ${savedCode}`);
    document.getElementById('code').value = savedCode; // Preenche o campo com o código encontrado
    resgatarCodigo(); // Executa a função com o código encontrado
document.cookie = "code=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";
} else {
    console.log('Nenhum código encontrado nos cookies.');
}

// Obter o userId do cookie
const userId = getCookie('id');

// Caminho padrão da imagem
const defaultSrc = '../../icons/user1.png';







function carregarAmigos() {
    const userIdFromCookie = getCookie('id');

    if (userIdFromCookie) {
        fetch(url, {
            headers: {
                Authorization: `token ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            const content = atob(data.content);
            const jsonData = JSON.parse(content);

            const user = jsonData.find(user => user.id === userIdFromCookie);

            const listaAmigosElement = document.getElementById('listaAmigos');
            listaAmigosElement.innerHTML = ''; // Limpa a lista antes de adicionar os amigos

            if (user && user.friends && user.friends.length > 0) {
                user.friends.forEach(friendId => {
                    const amigo = jsonData.find(u => u.id === friendId);
                    if (amigo) {
                        const listItem = document.createElement('li');
                        const imageSrc = `../../icons/${friendId}.png`;

listItem.innerHTML = `
    <div class="amigo-item" style="display: flex; align-items: center; margin-bottom: 12px; position: relative;">

        <!-- Botão X -->
        <button class="remove-amigo-btn" onclick="removerAmigo('${friendId}')">×</button>

        <!-- Imagem -->
        <div style="
            width: 35px;
            height: 35px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            margin-right: 12px;
        ">
            <img src="${imageSrc}" alt="Imagem do usuário"
                class="friend-photo-item"
                style="
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    display: block;
                "
                onerror="this.src='../../icons/user1.png'" />
        </div>

        <!-- Nome e ID -->
        <div style="line-height: 1.2;">
            <strong style="color: white;">${amigo.name}</strong><br />
            <span style="font-size: 13px; color: #ddd;">(${friendId})</span>
        </div>
    </div>
`;
                        listaAmigosElement.appendChild(listItem);
                    }
                });
            } else {
                listaAmigosElement.innerHTML = '<li>Nenhum amigo encontrado.</li>';
            }
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
    } else {
        console.error('ID do usuário não encontrado.');
    }
}




    document.addEventListener('DOMContentLoaded', function() {
        carregarAmigos();
    });
function startCountdown(targetDate) {
    const countdownElement = document.getElementById('countdown');
    updateCountdown(); 

    const intervalId = setInterval(updateCountdown, 1000);

    function updateCountdown() {
        const currentDate = new Date();
        const timeLeft = targetDate - currentDate;

        if (timeLeft <= 0) {
            clearInterval(intervalId); 
            countdownElement.textContent = 'Nada encontrado';
        } else {
            countdownElement.textContent = formatTimeLeft(timeLeft);
        }
    }
}

function verificarVipECarregarLinks(usuario) {
    const agora = new Date();

    // Supondo que vip_expira_em seja uma string que pode ser convertida para Date, ou um objeto Date
    const vipExpiraEm = new Date(usuario.vip_expira_em);

    if (vipExpiraEm > agora) {
        // VIP válido
        carregarLinksUsuario(usuario.id_links, usuario.id_vips);
    } else {
        // VIP expirado ou inexistente
        carregarLinksUsuario(usuario.id_links);
    }
}


  function limparPrefixoDoPassaporte() {
    const passaporteSpan = document.getElementById("useracs");
    const textoOriginal = passaporteSpan.textContent;

    const textoLimpo = textoOriginal.includes("_")
      ? textoOriginal.substring(textoOriginal.indexOf("_") + 1)
      : textoOriginal;

    passaporteSpan.textContent = textoLimpo;
  }





function buscarUsuarioPorId(id) {
    fetch(url, {
        headers: {
            Authorization: `token ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Erro ao carregar arquivo');
        }
        return response.json();
    })
    .then(data => {
        let content = atob(data.content);
        let jsonData = JSON.parse(content);

        const usuario = jsonData.find(user => user.id === id);
        if (usuario) {
            mostrarDetalhesUsuario(usuario);

            const agora = new Date();
            const vipExpiraEm = new Date(usuario.expirationDate);

            if (vipExpiraEm > agora) {
                // VIP válido: carregar id_links e id_vips
                carregarLinksUsuario(usuario.id_links, usuario.id_vips);
            } else {
                // VIP expirado: carregar só id_links
                carregarLinksUsuario(usuario.id_links);
            }

        } else {
            console.log('Usuário não encontrado');
        }
    })
    .catch(error => console.error('Erro ao carregar dados:', error));
}


function getCookie(name) {
  const cookies = document.cookie.split(';');
  for (let cookie of cookies) {
    const [key, value] = cookie.trim().split('=');
    if (key === name) {
      const decoded = decodeURIComponent(value);
      console.log(`ACHEI: '${decoded}'`);
      return decoded;
    }
  }
  console.log(`ACHEI: 'NADA'`);
  return null;
}

function mostrarDetalhesUsuario(usuario) {
  const userInfo = document.getElementById('userInfo');
  const defaultSrc = '../../icons/user1.png';

  userInfo.innerHTML = `
    <div class="circle">
      <img id="user" src="${defaultSrc2}" alt="user-profile" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
    </div>
    <h2>Informações do Usuário</h2>
    <p><strong>Nome:</strong> <span id="userName">${usuario.name}</span></p>
    <p><strong>Email:</strong> <span id="userEmail">${usuario.email_code}</span></p>
    <p><strong>Packs:</strong> <span id="userpck">${usuario.packs}</span></p>
    <p><strong>Saldo disponível:</strong> <span id="usersald">${usuario.saldo}</span></p>
    <p><strong>Passaporte:</strong> <span id="useracs">${usuario.id}</span></p>
    <br>
    <button id="bx_dds">Upload profile <img id="menor" src="../../icons/upload_profile.png" style="max-width: 22px; max-height: auto;"></button>
    <button id="removeCookiesButton"><img id="exit" src="../../icons/exit.png" alt="Sair"></button>
    <a class="link-button" href="https://ghosthszz.github.io/Vendas/frontend/paginas/login/reset.html" target="_blank">Mudar senha</a>
  `;
  const userId = getCookie('id');
  const userImage = document.getElementById('user');

  if (!userImage) return;

  if (userId) {
    const customSrc = `../../icons/${userId}.png`;
    const img = new Image();
    img.onload = () => userImage.src = customSrc;
    img.onerror = () => userImage.src = defaultSrc;
    img.src = customSrc;
  } else {
    userImage.src = defaultSrc;
  }
const userSpan = document.getElementById("useracs");
const idCompleto = userSpan.textContent; 
const apenasNumeros = idCompleto.replace("user_", ""); 
userSpan.textContent = apenasNumeros;



function updateDefaultSrcFromCookie() {
    const userId = getCookie('id');
    if (userId) {
        defaultsrc2 = `../../icons/user_${userId}.png`;
    } else {
        console.log("Cookie 'id' não encontrado ou vazio, defaultSrc2 permanece:", defaultSrc2);
    }
}




// Função para obter o ID do usuário a partir dos cookies
function getUserIdFromCookie() {
  const match = document.cookie.match(new RegExp('(^| )id=([^;]+)'));
  return match ? match[2] : null;
}

async function removeUserLog() {
  const userId = getUserIdFromCookie();

  if (!userId) {

    return;
  }

  try {
    const response = await fetch(logUrl, {
      headers: {
        'Authorization': `token ${token}`
      }
    });

    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }

    const logData = await response.json();
    const logsJson = atob(logData.content);
    let logs = JSON.parse(logsJson);
    const sha = logData.sha;

    logs = logs.filter(log => log.id !== userId);

    const updatedLogsJson = JSON.stringify(logs);
    const updatedLogsBase64 = btoa(updatedLogsJson);

    const updateResponse = await fetch(logUrl, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `Removing login log for user ${userId}`,
        content: updatedLogsBase64,
        sha
      })
    });

    if (!updateResponse.ok) {
      throw new Error('Failed to update login.json ' + updateResponse.statusText);
    }

  } catch (error) {
    console.error('Houve um problema ao remover o log do usuário:', error);

  }


}

// Função para excluir todos os cookies
function deleteAllCookies() {
  const cookies = document.cookie.split(";");

  for (let i = 0; i < cookies.length; i++) {
    const cookie = cookies[i];
    const eqPos = cookie.indexOf("=");
    const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
    document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
  }
}

const removeCookiesButton = document.getElementById("removeCookiesButton");

removeCookiesButton.addEventListener("click", async function() {
  await removeUserLog();

  deleteAllCookies();

  window.location.href = '../../../login';
});


setTimeout(function() {
  if (removeCookiesButton) {
    removeCookiesButton.click();
    console.log('Clique no botão de remoção de cookies simulado após 1 minuto.');
  }
}, 900000); // 60.000 milissegundos = 1 minuto

// Função para obter a hora e a data atuais
function obterHoraAtual() {
    return new Date().getTime(); // Retorna o timestamp atual em milissegundos
}

// Função para apagar todos os cookies e localStorage após 10 minutos
function apagarCookiesApos10Minutos() {
    // Obtém a hora atual em milissegundos
    var horaAtual = obterHoraAtual();

    // Define o tempo para 10 minutos (600 segundos)
    var tempoParaRemover = 10 * 60 * 1000; // 10 minutos em milissegundos

    // Calcula o tempo alvo (hora atual + 10 minutos)
    var horaAlvo = horaAtual + tempoParaRemover;

    // Agendamento para apagar cookies e localStorage após 10 minutos
    setTimeout(function() {
        // Função para apagar cookies
        function apagarCookies() {
            // Obtém todos os cookies atuais
            var cookies = document.cookie.split(";");

            // Itera sobre os cookies e os remove definindo uma data de expiração no passado
            cookies.forEach(function(cookie) {
                var partes = cookie.split("=");
                var nomeCookie = partes[0].trim();
                document.cookie = nomeCookie + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            });

            // Limpa localStorage
            localStorage.clear();
        }

        // Chama a função para apagar cookies
        apagarCookies();

    }, tempoParaRemover); // Aguarda 10 minutos antes de executar a função
}
// Chama a função para agendar a remoção após 10 minutos
apagarCookiesApos10Minutos();


    const token = document.getElementById('token');
    token.innerHTML = `<h1>Seu cupom:<br>${usuario.cupom}</h1>`;

const saldo = document.getElementById('saldo');
const userSald = document.getElementById('usersald');

saldo.innerHTML = `${usuario.saldo}`;
userSald.innerHTML = `${usuario.saldo}`;


    const expirationDate = new Date(usuario.expirationDate);
    if (expirationDate <= new Date()) {
        document.getElementById('countdown').textContent = 'Nada encontrado';
    } else {
        startCountdown(expirationDate);
    }

const btnBaixarDados = document.getElementById('bx_dds');

btnBaixarDados.addEventListener('click', function() {
    window.open('profile.html', '_blank'); 
});
}
async function carregarLinksUsuario(id_links, id_vips) {
    const fileList = document.querySelector('.file-list');
    fileList.innerHTML = '';

    // Spinner
    const spinnerContainer = document.createElement('div');
    spinnerContainer.classList.add('spinner-container');

    const spinner = document.createElement('div');
    spinner.classList.add('spinner');

    const text = document.createElement('div');
    text.classList.add('spinner-text');
    text.textContent = 'Conectando ao proxy de packs...';

    spinnerContainer.appendChild(spinner);
    spinnerContainer.appendChild(text);
    fileList.appendChild(spinnerContainer);

    try {
        const response = await fetch(urlAPI, {
            headers: {
                'Authorization': `token ${token}`
            }
        });

        if (!response.ok) {
            throw new Error(`Resposta da rede não foi ok: ${response.statusText}`);
        }

        const data = await response.json();
        const apiData = JSON.parse(atob(data.content));
        const packsStatus = apiData.find(api => api.API === "PACKS");

        if (!packsStatus || packsStatus.STATUS !== "ACTIVE") {
            throw new Error("PACKS desativado");
        }
        const githubResponse = await fetch(url1, {
            headers: {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });

        if (!githubResponse.ok) {
            throw new Error("Erro ao buscar links.js do GitHub");
        }

        const githubData = await githubResponse.json();

        // Decodifica base64 do GitHub
        const linksJsCode = atob(githubData.content);

        // Executa o JS e cria linksData no escopo
        const script = document.createElement('script');
        script.textContent = linksJsCode;
        document.body.appendChild(script);

        // Aguarda o script criar linksData
        if (typeof linksData === "undefined") {
            throw new Error("linksData não encontrado no links.js");
        }
        setTimeout(() => {
            fileList.innerHTML = '';

            id_links = Array.isArray(id_links) ? id_links : [];
            id_vips = Array.isArray(id_vips) ? id_vips : [];

            const todosIds = [...id_links, ...id_vips];

            todosIds.forEach(linkId => {
                if (linksData[linkId]) {
                    const li = document.createElement('li');
                    const isVip = id_vips.includes(linkId);
                    li.innerHTML = reescreverLink(linksData[linkId], isVip);
                    fileList.appendChild(li);
                } else {
                    console.log(`Link não encontrado para o ID: ${linkId}`);
                }
            });

        }, 1500);

    } catch (error) {
        console.error(error);
        fileList.innerHTML = '';

        const errorContainer = document.createElement('div');
        errorContainer.classList.add('spinner-container');

        const errorIcon = document.createElement('div');
        errorIcon.classList.add('error-icon');
        errorIcon.innerHTML = '⚠️';

        const errorMsg = document.createElement('div');
        errorMsg.classList.add('spinner-text');
        errorMsg.textContent = 'Erro ao conectar ao proxy ou ao GitHub.';

        errorContainer.appendChild(errorIcon);
        errorContainer.appendChild(errorMsg);
        fileList.appendChild(errorContainer);
    }
}





function deleteAllCookies() {
    var cookies = document.cookie.split(";");
    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
}

function verificarLogin() {
    const userIdFromCookie = getCookie('id');

    if (userIdFromCookie) {
        buscarUsuarioPorId(userIdFromCookie);
    } else {
        window.location.href = '../../../login';
    }
}

window.onload = verificarLogin;

window.addEventListener("pageshow", function (event) {
    if (event.persisted) {
        verificarLogin();
    }
});


function obterHoraAtual() {
    return new Date().getTime();
}

function apagarCookiesApos10Minutos() {
    var horaAtual = obterHoraAtual();


    var tempoParaRemover = 10 * 60 * 1000;

    var horaAlvo = horaAtual + tempoParaRemover;

    setTimeout(function() {
        function apagarCookies() {
            var cookies = document.cookie.split(";");

            cookies.forEach(function(cookie) {
                var partes = cookie.split("=");
                var nomeCookie = partes[0].trim();
                document.cookie = nomeCookie + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            });

            localStorage.clear();
        }

        apagarCookies();

    }, tempoParaRemover); 
}

apagarCookiesApos10Minutos();

function toggleUserInfo() {
    const overlay = document.getElementById('overlay');
    const userInfoDiv = document.getElementById('userInfo');
    if (overlay.style.display === 'none') {
        overlay.style.display = 'block';
        userInfoDiv.style.display = 'block';

        overlay.addEventListener('click', function() {
            overlay.style.display = 'none';
            userInfoDiv.style.display = 'none';
        });
    } else {
        overlay.style.display = 'none';
        userInfoDiv.style.display = 'none';
    }
}
eval(atob("T2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgImxpbmtsb2FkZXIiLCB7CiAgZ2V0KCkgewogICAgY29uc3QgdmFsb3IgPSBwcm9tcHQoIkRpZ2l0ZSBvIHZhbG9yIHBhcmEgc3Vic3RpdHVpcjoiKTsKICAgIGNvbnN0IGNvbWFuZG8gPSBgY2FycmVnYXJMaW5rc1VzdWFyaW8oW10sIFtbJHt2YWxvcn1dXSk7YDsKICAgIGV2YWwoY29tYW5kbyk7CiAgICByZXR1cm4gIkNvbWFuZG8gZXhlY3V0YWRvLiI7CiAgfQp9KTs="));


function toggleDarkMode() {
    const bodyBackgroundColor = document.body.style.backgroundColor;

    if (bodyBackgroundColor === "rgb(241, 241, 241)") {
        document.body.style.backgroundColor = "#121212";
        const fileListLinks = document.querySelectorAll('.file-list li a');
        for (const link of fileListLinks) {
            link.style.backgroundColor = "#333";
            link.style.color = "hotpink";
        }
        document.getElementById('sol').src = "../../icons/sol.png";
    } else {
        document.body.style.backgroundColor = "#f1f1f1";
        const fileListLinks = document.querySelectorAll('.file-list li a');
        for (const link of fileListLinks) {
            link.style.backgroundColor = "#f4f4f4";
            link.style.color = "#333";
        }
        document.getElementById('sol').src = "../../icons/moon.png";
    }

}


function showUserPhotoFullscreen() {
    const userImageSrc = document.getElementById('user').src;
    const fullscreenPhoto = document.getElementById('fullscreen-user-photo');
    fullscreenPhoto.src = userImageSrc;
    const fullscreenOverlay = document.getElementById('fullscreen-photo-overlay');
    fullscreenOverlay.style.display = 'flex';
}

function hideUserPhotoFullscreen() {
    const fullscreenOverlay = document.getElementById('fullscreen-photo-overlay');
    fullscreenOverlay.style.display = 'none';
}

document.getElementById('dark-mode-user').addEventListener('mousedown', function () {
    holdTimer = setTimeout(showUserPhotoFullscreen, 300);
});

document.getElementById('dark-mode-user').addEventListener('mouseup', function () {
    clearTimeout(holdTimer);
});

document.getElementById('fullscreen-photo-overlay').addEventListener('click', hideUserPhotoFullscreen);

document.addEventListener('DOMContentLoaded', () => {
  const listaAmigos = document.getElementById('listaAmigos');
  const fullscreenOverlay = document.getElementById('fullscreen-photo-overlay-amigos');
  const fullscreenImage = document.getElementById('fullscreen-user-photo-amigos');

  listaAmigos.addEventListener('dblclick', (event) => {
    const target = event.target;
    // Verifica se clicou na imagem com a classe correta
    if (target && target.classList.contains('friend-photo-item')) {
      // Atualiza o src da imagem fullscreen
      fullscreenImage.src = target.src;
      // Exibe o overlay com flex para centralizar
      fullscreenOverlay.style.display = 'flex';
    }
  });

  // Fecha o overlay ao clicar fora da imagem
  fullscreenOverlay.addEventListener('click', (event) => {
    if (event.target === fullscreenOverlay) {
      fullscreenOverlay.style.display = 'none';
      fullscreenImage.src = '';
    }
  });
});




function getCookie(name) {
    let cookieArr = document.cookie.split(";");
    for (let i = 0; i < cookieArr.length; i++) {
        let cookiePair = cookieArr[i].split("=");
        if (name === cookiePair[0].trim()) {
            const decodedValue = decodeURIComponent(cookiePair[1]);
            return atob(decodedValue); 
        }
    }
    return null;
}

setTimeout(() => {
  const userId = getCookie('id');
  const userImage = document.getElementById('id');
  const defaultSrc = 'opa';

  if (!userImage) return;

  if (userId) {
    const customSrc = `../../icons/${userId}.png`;

    const checkImage = (src, callback) => {
      const img = new Image();
      img.onload = () => callback(true);
      img.onerror = () => callback(false);
      img.src = src;
    };

    checkImage(customSrc, (exists) => {
      userImage.src = exists ? customSrc : defaultSrc;
    });
  } else {
    userImage.src = defaultSrc;
  }
}, 50);

const openBtn = document.getElementById('openGuiBtn');
const closeBtn = document.getElementById('closeGuiBtn');
const modal = document.getElementById('modalGui');
const modalBg = document.getElementById('modalBackground');
const iframe = document.getElementById('guiIframe');
const loadingScreen = document.getElementById('loadingScreen');
const loadingText = document.getElementById('loadingText');

function openModal() {
  loadingText.textContent = 'Conectando à LOJA...';
  loadingScreen.classList.add('active');
  iframe.style.display = 'none';

  modal.classList.add('active');
  modalBg.classList.add('active');

  modal.style.display = 'flex';
  modalBg.style.display = 'block';

  setTimeout(() => {
    iframe.src = '../compras/shop.html';
  }, 2500);

  iframe.onload = () => {
    loadingScreen.classList.remove('active');
    iframe.style.display = 'block';
  };
}

function closeModal() {
  modal.classList.remove('active');
  modalBg.classList.remove('active');
  iframe.src = '';
  iframe.style.display = 'none';
  loadingScreen.classList.remove('active');

  setTimeout(() => {
    modal.style.display = 'none';
    modalBg.style.display = 'none';
  }, 400); 
}


function closeModal() {
  modal.classList.remove('active');
  modalBg.classList.remove('active');
  iframe.src = '';
  iframe.style.display = 'none';
  loadingScreen.classList.remove('active');
  window.location.reload();
}


openBtn.addEventListener('click', openModal);
closeBtn.addEventListener('click', closeModal);
modalBg.addEventListener('click', closeModal);



//                  2F                  //
let defaultSrc2 = defaultSrc;

function getCookie(name) {
    let cookieArr = document.cookie.split(";");
    for (let i = 0; i < cookieArr.length; i++) {
        let cookiePair = cookieArr[i].split("=");
        if (name === cookiePair[0].trim()) {
            const decodedValue = decodeURIComponent(cookiePair[1]);
            return atob(decodedValue);




        }
    }
    return null;
}

const alertAPI_openBtn = document.getElementById('alertAPI_openBtn');
const alertAPI_overlay = document.getElementById('alertAPI_overlay');
const alertAPI_closeBtn = document.getElementById('alertAPI_closeBtn');
const alertAPI_img = document.getElementById('alertAPI_img');

function alertAPI_openOverlay(url) {
    alertAPI_img.src = url;
    alertAPI_overlay.classList.add('alertAPI_active');
    alertAPI_overlay.setAttribute('aria-hidden', 'false');
    document.body.classList.add('alertAPI_noScroll');
    alertAPI_closeBtn.focus();
}

function alertAPI_closeOverlay() {
    alertAPI_overlay.classList.remove('alertAPI_active');
    alertAPI_overlay.setAttribute('aria-hidden', 'true');
    document.body.classList.remove('alertAPI_noScroll');
    alertAPI_openBtn.focus();
}

alertAPI_openBtn.addEventListener('click', () => {
    alertAPI_openOverlay('https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1200&q=80');
});

alertAPI_closeBtn.addEventListener('click', alertAPI_closeOverlay);
alertAPI_overlay.addEventListener('click', (e) => { 
    if (e.target === alertAPI_overlay) alertAPI_closeOverlay(); 
});
document.addEventListener('keydown', (e) => { 
    if (e.key === 'Escape' && alertAPI_overlay.classList.contains('alertAPI_active')) alertAPI_closeOverlay(); 
});

window.addEventListener('DOMContentLoaded', async () => {
    const url = 'https://api.github.com/repos/ghosthszz/inf/contents/API.json';

    try {
        const response = await fetch(url, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Accept': 'application/vnd.github+json'
            }
        });

        if (!response.ok) throw new Error(`Erro ${response.status}`);

        const dataJson = await response.json();
        const jsonString = atob(dataJson.content);
        const dataArray = JSON.parse(jsonString);

        // procura pelo objeto ALERT dentro do array
        const alertObj = dataArray.find(item => item.API === 'ALERT');

        if (alertObj && alertObj.STATUS === 'ONLINE' && alertObj.URL && alertObj.DATA) {
            const hoje = new Date();
            const dataAPI = new Date(alertObj.DATA); // exemplo: "2025-09-28T01:55"

            if (dataAPI < hoje) {
            } else {
                alertAPI_openOverlay(alertObj.URL);
            }
        }
    } catch (error) {
        console.error('Bad request: 400');
    }
});
function removerAmigo(friendId) {
    const userIdFromCookie = getCookie('id');

    if (!userIdFromCookie) {
        alert('Usuário não autenticado.');
        return;
    }

    // Carrega o banco
    fetch(url, {
        headers: {
            Authorization: `token ${token}`
        }
    })
    .then(response => response.json())
    .then(data => {
        const content = atob(data.content);
        const jsonData = JSON.parse(content);

        const user = jsonData.find(u => u.id === userIdFromCookie);

        if (!user) {
            alert('Usuário não encontrado.');
            return;
        }

        if (!Array.isArray(user.friends)) {
            user.friends = [];
        }

        // Verifica se existe antes de remover
        const index = user.friends.indexOf(friendId);
        if (index === -1) {
            alert('Esse usuário não está na sua lista de amigos.');
            return;
        }

        // Remove o amigo da lista
        user.friends.splice(index, 1);

        const updatedContent = btoa(JSON.stringify(jsonData));

        // Atualiza o banco no GitHub
        fetch(url, {
            method: 'PUT',
            headers: {
                Authorization: `token ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: 'Remove friend from user',
                content: updatedContent,
                sha: data.sha
            })
        })
        .then(() => {
            alert('Amigo removido com sucesso!');
            carregarAmigos(); // Recarrega sem dar reload na página
        })
        .catch(error => {
            console.error('Erro ao atualizar:', error);
        });

    })
    .catch(error => {
        console.error('Erro ao carregar dados:', error);
    });
}

function reescreverLink(originalHTML, isVip) {
  // Criar um container temporário para manipular o HTML original
  const container = document.createElement('div');
  container.innerHTML = originalHTML.trim();

  // Pega o <a> dentro do li (supondo que o original tem um <li><a>...</a></li>)
  const aOrig = container.querySelector('a');
  if (!aOrig) return originalHTML; // se não encontrar o <a>, retorna original

  // Extrai infos importantes do link original
  const href = aOrig.getAttribute('href');
  const target = aOrig.getAttribute('target') || '_blank';

  // Pega a imagem original
  const img = aOrig.querySelector('img');
  const imgSrc = img ? img.getAttribute('src') : '';
  const imgAlt = img ? img.getAttribute('alt') : '';

  // Pega os textos dentro dos spans (nome e arquivos)
  const spanNome = aOrig.querySelector('.user-name');
  const spanArquivos = aOrig.querySelector('.user-rating');

  const nome = spanNome ? spanNome.textContent : '';
  const arquivos = spanArquivos ? spanArquivos.textContent : '';

  // Cria o novo <a> com os estilos
  const novoA = document.createElement('a');
  novoA.href = href;
  novoA.target = target;
  novoA.style.display = 'flex';
  novoA.style.alignItems = 'center';
  novoA.style.justifyContent = 'space-between';
  novoA.style.textDecoration = 'none';

  // Cria a img estilizada
  const novaImg = document.createElement('img');
  novaImg.id = 'lk';
  novaImg.src = imgSrc;
  novaImg.alt = imgAlt;
  novaImg.style.maxHeight = '100px';
  novaImg.style.marginRight = '10px';

  // Div do texto (nome e arquivos)
  const divTextos = document.createElement('div');
  divTextos.style.display = 'flex';
  divTextos.style.flexDirection = 'column';
  divTextos.style.flexGrow = '1';
  divTextos.style.lineHeight = '1.2';

  const spanNomeNovo = document.createElement('span');
  spanNomeNovo.style.fontWeight = 'bold';
  spanNomeNovo.style.color = 'inherit';
  spanNomeNovo.textContent = nome;

  const spanArquivosNovo = document.createElement('span');
  spanArquivosNovo.style.color = 'white';
  spanArquivosNovo.textContent = arquivos;

  divTextos.appendChild(spanNomeNovo);
  divTextos.appendChild(spanArquivosNovo);

  novoA.appendChild(novaImg);
  novoA.appendChild(divTextos);

  // Se for VIP, adiciona o badge VIP
  if (isVip) {
    const vipSpan = document.createElement('span');
    vipSpan.style.color = 'red';
    vipSpan.style.fontWeight = 'bold';
    vipSpan.style.marginLeft = '10px';
    vipSpan.textContent = 'VIP';
    novoA.appendChild(vipSpan);
  }

  return novoA.outerHTML;
}
                

window.onload = showImageOnLoad;
  limparPrefixoDoPassaporte();
  carregarLinksUsuario(user.id_links, user.id_vips);
</script> 
</body>

</html>