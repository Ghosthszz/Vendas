<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasta de Arquivos</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <div id="token">
        <h1>Seu cupom: <br>NULL</h1>
    </div>
    <div>
        <img id="comp" src="../../icons/compartilhar.png" alt="Compartilhe" onclick="redirecionarECriarCookie()">
    </div>
    <div id="comp1" class="container">     
        <h1>Pasta de Arquivos
         <button id="dark-mode-user"onclick="toggleUserInfo()"><img id="user" src="../../icons/user1.png" alt="user-profile"></button> </h1>
        <ul class="file-list">

            <ul class="pagination">
            <li><a href="#comp1">1</a></li>
            <li><a href="#comp2">2</a></li>
            <li><a href="#3">3</a></li>
        </ul>
        </ul>

        <h1 id="catalogo">Catálogo: <br>
        <img src="../../icons/404.png" alt="error"> <br>
    Indisponivel </h1>

        <div id="imagemModal">
            <span class="fechar">&times;</span>
            <img class="modal-conteudo" id="imgAmpliada">
        </div>

        <h1>VIP:</h1>
        <div id="countdown-container">
            <div id="countdown"></div>
        </div>
    </div>
    <div id="overlay"></div>
    <div id="userInfo" style="display: none;">
        <h2>User Info</h2>
        <p><strong>Name:NULL</strong></p>
        <p><strong>Email:NULL</strong></p>
        <p><strong>Packs:NULL</strong></p>
        <p><strong>Saldo disponível:NULL</strong></p>
        <p><strong>Chave de comunicação:NULL</strong></p>
        <br>
        <button id="bx_dds">Baixar dados</button>
        <button id="removeCookiesButton"><img id="exit" src="../../icons/exit.png" alt="sair"></button>
        <button id="dark-mode-toggle" onclick="toggleDarkMode()"><img id="sol" src="../../icons/sol.png" alt="light-mode"></button>
    </div>
</body>
<script>
// Função para formatar o tempo restante de uma data
function formatTimeLeft(time) {
    const days = Math.floor(time / (1000 * 60 * 60 * 24));
    const hours = Math.floor((time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((time % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((time % (1000 * 60)) / 1000);
    return `${days} dias ${hours} horas ${minutes} minutos ${seconds} segundos`;
}

// Função para iniciar o countdown
function startCountdown(targetDate) {
    const countdownElement = document.getElementById('countdown');
    updateCountdown(); // Chamada inicial para atualizar imediatamente

    const intervalId = setInterval(updateCountdown, 1000); // Atualização a cada segundo

    function updateCountdown() {
        const currentDate = new Date();
        const timeLeft = targetDate - currentDate;

        if (timeLeft <= 0) {
            clearInterval(intervalId); // Limpar o intervalo se o tempo restante for inválido
            countdownElement.textContent = 'Nada encontrado';
        } else {
            countdownElement.textContent = formatTimeLeft(timeLeft);
        }
    }
}

// Função para obter o valor de um cookie pelo nome
function getCookie(name) {
    const cookieValue = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return cookieValue ? decodeURIComponent(cookieValue.pop()) : '';
}

// Função para buscar informações do usuário por ID
function buscarUsuarioPorId(id) {
    fetch('../../js/dados.json')
        .then(response => response.json())
        .then(data => {
            const usuario = data.find(user => user.id === id);
            if (usuario) {
                mostrarDetalhesUsuario(usuario);
                carregarLinksUsuario(usuario.id_links);
            } else {
                console.log('Usuário não encontrado');
            }
        })
        .catch(error => console.error('Erro ao carregar dados:', error));
}

// Função para mostrar os detalhes do usuário na interface
function mostrarDetalhesUsuario(usuario) {
    const userInfo = document.getElementById('userInfo');
    userInfo.innerHTML = `
        <h2>Informações do Usuário</h2>
        <p><strong>Nome:</strong> <span id="userName">${usuario.name}</span></p>
        <p><strong>Email:</strong> <span id="userEmail">${usuario.email}</span></p>
        <p><strong>Packs:</strong> <span id="userpck">${usuario.packs}</span></p>
        <p><strong>Saldo disponível:</strong> <span id="usersald">${usuario.saldo}</span></p>
        <p><strong>Chave de comunicação:</strong> <span id="useracs">${usuario.id}</span></p>
        <br>
        <button id="bx_dds">Baixar Dados</button>
        <button id="removeCookiesButton"><img id="exit" src="../../icons/exit.png" alt="Sair"></button>
        <button id="dark-mode-toggle" onclick="toggleDarkMode()"><img id="sol" src="../../icons/sol.png" alt="Modo Claro"></button>
    `;

    const token = document.getElementById('token');
    token.innerHTML = `<h1>Seu cupom:<br>${usuario.cupom}</h1>`;

    // Verificar se a data de expiração é válida antes de iniciar o countdown
    const expirationDate = new Date(usuario.expirationDate);
    if (expirationDate <= new Date()) {
        document.getElementById('countdown').textContent = 'Nada encontrado';
    } else {
        startCountdown(expirationDate);
    }

    // Adicionar evento ao botão "Baixar Dados"
    const btnBaixarDados = document.getElementById('bx_dds');
    btnBaixarDados.addEventListener('click', function() {
        const senhaInserida = prompt('Por favor, insira a senha:');
        if (senhaInserida === usuario.password) {
            alert('Função disponível em breve!');
        } else {
            alert('Senha incorreta. Tente novamente.');
        }
    });

    // Adicionar evento ao botão "Remover Cookies"
    const removeCookiesButton = document.getElementById("removeCookiesButton");
    removeCookiesButton.addEventListener("click", function() {
        deleteAllCookies();
        window.location.href = '../../../index.html'; // Redireciona para a página inicial após remover os cookies
    });
}

// Função para carregar os links do usuário na lista
function carregarLinksUsuario(id_links) {
    const fileList = document.querySelector('.file-list');
    fileList.innerHTML = ''; // Limpar a lista atual antes de adicionar os novos links

    id_links.forEach(linkId => {
        if (linksData[linkId]) {
            const li = document.createElement('li');
            li.innerHTML = linksData[linkId];
            fileList.appendChild(li);
        } else {
            console.log(`Link não encontrado para o ID: ${linkId}`);
        }
    });
}

// Função para deletar todos os cookies
function deleteAllCookies() {
    var cookies = document.cookie.split(";");
    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        var eqPos = cookie.indexOf("=");
        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
}

// Evento disparado quando a janela é carregada
window.onload = function() {
    const userIdFromCookie = getCookie('id');
    if (userIdFromCookie) {
        buscarUsuarioPorId(userIdFromCookie);
    } else {
        console.log('Cookie "id" não encontrado');
        // Redirecionar para a página inicial caso os cookies necessários não estejam presentes
        window.location.href = '../../../index.html';
    }
};

// Função para alternar a exibição das informações do usuário
function toggleUserInfo() {
    const overlay = document.getElementById('overlay');
    const userInfoDiv = document.getElementById('userInfo');
    if (overlay.style.display === 'none') {
        overlay.style.display = 'block';
        userInfoDiv.style.display = 'block';

        overlay.addEventListener('click', function() {
            overlay.style.display = 'none';
            userInfoDiv.style.display = 'none';
        });
    } else {
        overlay.style.display = 'none';
        userInfoDiv.style.display = 'none';
    }
}

// Função para alternar o modo escuro
function toggleDarkMode() {
    const bodyBackgroundColor = document.body.style.backgroundColor;

    if (bodyBackgroundColor === "rgb(241, 241, 241)") {
        document.body.style.backgroundColor = "#121212";
        const fileListLinks = document.querySelectorAll('.file-list li a');
        for (const link of fileListLinks) {
            link.style.backgroundColor = "#333";
            link.style.color = "hotpink";
        }
        document.getElementById('sol').src = "../../icons/sol.png";
    } else {
        document.body.style.backgroundColor = "#f1f1f1";
        const fileListLinks = document.querySelectorAll('.file-list li a');
        for (const link of fileListLinks) {
            link.style.backgroundColor = "#f4f4f4";
            link.style.color = "#333";
        }
        document.getElementById('sol').src = "../../icons/moon.png";
    }
}

</script>
<script src="../../js/links.js"></script>
</html>
