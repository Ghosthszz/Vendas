<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo</title>
  <style>/* Reset */
/* ===== Reset & Body ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Inter", "Segoe UI", sans-serif;
  background: #0f172a;
  color: #f1f5f9;
  line-height: 1.5;
}

/* ===== Layout Principal ===== */
.container {
  display: flex;
  min-height: 100vh;
}

/* ===== Sidebar ===== */
.sidebar {
  width: 260px;
  background: linear-gradient(180deg, #111827, #1e293b);
  color: #e2e8f0;
  display: flex;
  flex-direction: column;
  padding: 25px 20px;
  border-right: 1px solid #334155;
}

.profile {
  text-align: center;
  margin-bottom: 35px;
}

.profile-img {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  margin-bottom: 12px;
  border: 3px solid #8b5cf6;
}

.sidebar h3 {
  font-size: 1.05rem;
  color: #f1f5f9;
}

.sidebar nav a {
  display: block;
  padding: 12px 15px;
  margin: 6px 0;
  color: #cbd5e1;
  text-decoration: none;
  border-radius: 10px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.sidebar nav a:hover,
.sidebar nav a.active {
  background: #8b5cf6;
  color: #fff;
  transform: scale(1.02);
}

/* ===== Main ===== */
.main {
  flex: 1;
  padding: 35px;
  background: #1e293b;
  overflow-y: auto;
}

.main h1 {
  font-size: 2rem;
  font-weight: 600;
  margin-bottom: 25px;
  color: #f8fafc;
}

/* ===== Cards ===== */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.card {
  background: #1e293b;
  padding: 22px;
  border-radius: 14px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  border-left: 5px solid #8b5cf6;
  transition: transform 0.3s, box-shadow 0.3s;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.3);
}

.card p {
  font-size: 0.95rem;
  color: #94a3b8;
}

.card h2 {
  font-size: 1.6rem;
  margin-top: 8px;
  color: #8b5cf6;
}

/* ===== Gráfico ===== */
.grafico {
  background: #0f172a;
  border-radius: 14px;
  height: 280px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-style: italic;
  color: #cbd5e1;
  box-shadow: 0 5px 20px rgba(0,0,0,0.15);
}

#usersSection {
  padding: 1.5rem;
  background: #0d1117;
  color: #e6edf3;
  min-height: 100%;
  font-family: "Segoe UI", Roboto, sans-serif;
}

#usersSection h1 {
  font-size: 1.6rem;
  margin-bottom: 1rem;
  font-weight: 600;
  color: #fff;
}

/* Campo de busca */
#usersSection #searchInput {
  width: 100%;
  max-width: 400px;
  padding: 0.6rem 0.8rem;
  border: 1px solid #30363d;
  border-radius: 6px;
  background: #111827;
  color: #e6edf3;
  font-size: 0.95rem;
  outline: none;
  margin-bottom: 1.2rem;
  transition: border 0.2s, box-shadow 0.2s;
}

#usersSection #searchInput:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 2px rgba(59,130,246,0.4);
}

/* Lista de usuários */
#userList {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

/* Card de usuário */
#userList .user-card {
  background: #161b22;
  padding: 0.8rem 1rem;
  border: 1px solid #30363d;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  transition: background 0.15s ease, transform 0.15s ease;
}

#userList .user-card:hover {
  background: #1c2128;
  transform: translateX(2px);
}

#userList .user-card img {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
}

#userList .user-card h3 {
  font-size: 1rem;
  font-weight: 500;
  margin: 0;
  color: #e6edf3;
}

/* Detalhes do usuário */
.user-details {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #161b22;
  padding: 1.5rem;
  border: 1px solid #30363d;
  border-radius: 10px;
  width: 90%;
  max-width: 500px;
  z-index: 999;
  color: #e6edf3;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
}

.user-details .details-header {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  margin-bottom: 1rem;
}

.user-details .details-header img {
  width: 56px;
  height: 56px;
  border-radius: 50%;
}

.user-details .details-header h2 {
  font-size: 1.2rem;
  margin: 0;
}

.user-details p {
  margin: 0.3rem 0;
  font-size: 0.95rem;
}

.user-details .actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  margin-top: 1rem;
}

.user-details .actions button {
  flex: 1 1 auto;
  background: #238636;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 0.4rem 0.6rem;
  cursor: pointer;
  font-size: 0.85rem;
  transition: background 0.2s;
}

.user-details .actions button:hover {
  background: #2ea043;
}

.user-details .close-details {
  display: block;
  margin: 1rem auto 0;
  background: #30363d;
  color: #e6edf3;
  border: none;
  border-radius: 6px;
  padding: 0.4rem 1rem;
  cursor: pointer;
}

.user-details .close-details:hover {
  background: #484f58;
}

/* ===== Commit Card ===== */
.commit-card {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 12px;
  padding: 14px 18px;
  box-shadow: 0 5px 18px rgba(0,0,0,0.15);
  transition: transform 0.2s, box-shadow 0.2s;
}

.commit-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
}

.commit-message {
  font-size: 0.95rem;
  font-weight: 500;
  color: #f1f5f9;
}

.commit-meta {
  font-size: 13px;
  color: #94a3b8;
  display: flex;
  align-items: center;
  gap: 8px;
}

.commit-meta img {
  width: 20px;
  height: 20px;
  border-radius: 50%;
}

/* ===== APIs ===== */
.api-card {
  background: #1e293b;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.2);
  color: #f1f5f9;
}

.api-status.active {
  background: #22c55e;
  color: #f8fafc;
}

.api-status.offline {
  background: #ef4444;
  color: #f8fafc;
}
#loaderOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(15, 23, 42, 0.8); /* fundo escuro */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

#loader {
  width: 120px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  animation: glowLoader 1.2s infinite ease-in-out;
}

#loader img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
}

/* Animação sutil de glow */
@keyframes glowLoader {
  0%, 100% {
    box-shadow: 0 0 20px rgba(51, 65, 85, 0.3);
  }
  50% {
    box-shadow: 0 0 35px rgba(51, 65, 85, 0.6);
  }
}

#packsContainer {
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}


/* ===== Pack Card Horizontal ===== */
.file-list {
  background: #1e293b;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
  transition: transform 0.3s, box-shadow 0.3s;
  list-style: none;
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 12px;
  gap: 15px;
}

.file-list:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
}

/* ===== Imagem do Pack ===== */
.file-list img#lk {
  width: 100px;
  height: 100px;
  border-radius: 50%; /* circular */
  object-fit: cover;
  object-position: center;
  flex-shrink: 0; /* não encolhe */
  border: 2px solid #8b5cf6;
  transition: transform 0.3s;
}

.file-list:hover img#lk {
  transform: scale(1.05);
}

/* ===== Texto do Pack ===== */
.text-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 4px;
}

.user-name {
  font-size: 1.2rem;
  font-weight: 600;
  color: #f1f5f9;
}

.user-rating {
  font-size: 0.95rem;
  color: #94a3b8;
}

.user-desc {
  font-size: 0.9rem;
  color: #cbd5e1;
}

/* ===== Responsividade ===== */
@media (max-width: 480px) {
  .file-list {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .file-list img#lk {
    width: 80px;
    height: 80px;
  }

  .text-container {
    gap: 2px;
  }
}
/* ===== Botão Adicionar Pack ===== */
#addPackButton {
  background: #8b5cf6;          /* roxo principal */
  color: #fff;                  /* texto branco */
  border: none;
  border-radius: 10px;          /* cantos arredondados */
  padding: 0.7rem 1.5rem;       /* espaçamento interno */
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}

/* Hover */
#addPackButton:hover {
  background: #a477f9;          /* tom mais claro de roxo */
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
}

/* Ativo / clicado */
#addPackButton:active {
  transform: translateY(0);
  box-shadow: 0 3px 8px rgba(139, 92, 246, 0.3);
}
/* ===== Formulário Adicionar Pack ===== */
#addPackForm {
  background: #1e293b;             /* mesmo tom da main */
  padding: 25px 20px;
  border-radius: 14px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  max-width: 500px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 15px;
  animation: fadeIn 0.3s ease-in-out;
}

#addPackForm label {
  display: flex;
  flex-direction: column;
  font-size: 0.95rem;
  font-weight: 500;
  color: #f1f5f9;
}

#addPackForm input[type="text"],
#addPackForm input[type="number"],
#addPackForm input[type="file"] {
  margin-top: 5px;
  padding: 0.6rem 0.8rem;
  border: 1px solid #30363d;
  border-radius: 8px;
  background: #111827;
  color: #e6edf3;
  font-size: 0.95rem;
  outline: none;
  transition: border 0.2s, box-shadow 0.2s;
}

#addPackForm input[type="text"]:focus,
#addPackForm input[type="number"]:focus,
#addPackForm input[type="file"]:focus {
  border-color: #8b5cf6;
  box-shadow: 0 0 0 2px rgba(139,92,246,0.3);
}

#addPackForm button[type="submit"] {
  background: #8b5cf6;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 0.7rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  align-self: flex-start;
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}

#addPackForm button[type="submit"]:hover {
  background: #a477f9;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(139, 92, 246, 0.5);
}

#addPackForm button[type="submit"]:active {
  transform: translateY(0);
  box-shadow: 0 3px 8px rgba(139, 92, 246, 0.3);
}

/* ===== Animação de entrada ===== */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== Responsividade ===== */
@media (max-width: 480px) {
  #addPackForm {
    padding: 20px 15px;
    width: 90%;
  }
}
/* Container geral da seção */
.grafico {
  background-color: #1e1e2f;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  margin-top: 20px;
  color: #fff;
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 1000px;
  height: 650px;       /* aumenta a altura máxima */
  overflow-y: auto;        /* habilita scroll se necessário */
}

/* Título */
.grafico h2 {
  font-size: 1.6rem;
  margin-bottom: 15px;
  border-bottom: 1px solid #444;
  padding-bottom: 5px;
}

/* Lista de notas em grid responsivo */
#notesList {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 15px;
  list-style: none;
  padding: 0;
  margin: 0;
  width: 950px;
  max-height: 350px;       /* altura maior para várias notas */
  overflow-y: auto;
}

#notesList li {
  background-color: #2a2a3d;
  padding: 12px;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  word-break: break-word;
  min-height: 100px;
  transition: transform 0.2s, box-shadow 0.2s;
}

#notesList li:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

#notesList li a {
  color: #00bfff;
  text-decoration: none;
  margin-top: 5px;
}

#notesList li a:hover {
  text-decoration: underline;
}

/* Formulário de nova nota (Uiverse.io style) */
.container_chat_bot {
  display: flex;
  flex-direction: column;
  width: 100%;
}

.container_chat_bot .container-chat-options {
  position: relative;
  display: flex;
  background: linear-gradient(to bottom right, #7e7e7e, #363636);
  border-radius: 16px;
  padding: 2px;
  overflow: hidden;
}

.container_chat_bot .container-chat-options .chat {
  display: flex;
  flex-direction: column;
  background-color: rgba(0, 0, 0, 0.55);
  border-radius: 15px;
  width: 100%;
  overflow: hidden;
}

.container_chat_bot .chat .chat-bot textarea {
  background-color: transparent;
  border-radius: 16px;
  border: none;
  width: 100%;
  min-height: 60px;       /* deixa mais espaço para escrever */
  color: #ffffff;
  font-family: sans-serif;
  font-size: 14px;
  padding: 12px;
  resize: none;
  outline: none;
}

.container_chat_bot .chat .options {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  gap: 10px;
}

.container_chat_bot .chat .options .btns-add input[type="file"] {
  color: #fff;
  cursor: pointer;
}

.container_chat_bot .chat .options .btn-submit {
  display: flex;
  padding: 6px;
  background-image: linear-gradient(to top, #292929, #555555, #292929);
  border-radius: 10px;
  cursor: pointer;
  border: none;
  outline: none;
  transition: all 0.15s ease;
  color: #fff;
}

.container_chat_bot .chat .options .btn-submit svg {
  width: 28px;
  height: 28px;
}

/* Scroll e responsividade */
@media (max-width: 1024px) {
  #notesList {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}

@media (max-width: 768px) {
  #notesList {
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  }
}

@media (max-width: 480px) {
  #notesList {
    grid-template-columns: 1fr;
  }
}
#notesContainer {
  margin-top: 10px;
}

#notesList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* 3 colunas aproximadas, responsivo */
  gap: 10px;
  list-style: none;
  padding: 0;
}

#notesList li {
  background-color: #2c2c2c;
  border-radius: 10px;
  padding: 10px;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  word-break: break-word;
}

#notesList li p {
  margin: 0 0 8px 0;
}

#notesList li img {
  width: auto;
  height: 60px;
  object-fit: cover;
  border-radius: 5px;
  margin-top: 5px;
  border: 1px solid #555;
}

</style>
</head>
<body>
<!-- Loader com overlay -->
<div id="loaderOverlay">
  <div id="loader">
    <img src="../../icons/llsecrets_sf.png" alt="Carregando...">
  </div>
</div>



<div class="container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="profile">
      <img src="../../icons/user1.png" alt="Admin" class="profile-img">
      <h3>Admin $NAME</h3>
    </div>
    <nav>
      <a href="#" class="active" data-section="dashboardSection">Dashboard</a>
      <a href="#" data-section="inboxSection">Inbox</a>
      <a href="#" data-section="usersSection" id="usersTab">Users</a>
      <a href="#" data-section="profileSection">Create user</a>
      <a href="#" data-section="packs">Packs</a>
      <a href="#" data-section="apisSection">APIs</a>
      <a href="#" data-section="globalSection">Global Settings</a>
    </nav>
  </aside>

  <!-- Conteúdo principal -->
  <main class="main">
    <!-- Dashboard -->
    <section id="dashboardSection">
      <h1>Dashboard</h1>
      <div class="cards">
        <div class="card">
          <p>Rendas</p>
          <h2 id="renda" >R$ 0,00</h2>
        </div>
        <div class="card">
          <p>Compras</p>
          <h2 id="compras">0</h2>
        </div>
        <div class="card">
          <p>Clientes</p>
          <h2 id="clientes">0 novos</h2>
        </div>
        <div class="card">
          <p>Packs</p>
          <h2 id="packs">0</h2>
        </div>
      </div>
<div class="grafico">
  <!-- Título -->
  <h2>Notas rápidas</h2>

  <!-- Lista de notas em grid responsivo -->
  <ul id="notesList">Carregando notas...</ul>

  <!-- Formulário de nova nota (estilo Uiverse.io) -->
  <!-- From Uiverse.io by Cobp -->
  <div class="container_chat_bot">
    <div class="container-chat-options">
      <div class="chat">
        <div class="chat-bot">
          <textarea
            id="noteText"
            placeholder="Escreva sua nota...✦˚"
            rows="3"
          ></textarea>
        </div>
        <div class="options">
          <div class="btns-add">
            <input type="file" id="noteFile" accept=".jpg,.jpeg,.png,.pdf" />
          </div>
          <button id="postNoteBtn" class="btn-submit">
            <i>
              <svg viewBox="0 0 512 512">
                <path
                  fill="currentColor"
                  d="M473 39.05a24 24 0 0 0-25.5-5.46L47.47 185h-.08a24 24 0 0 0 1 45.16l.41.13l137.3 58.63a16 16 0 0 0 15.54-3.59L422 80a7.07 7.07 0 0 1 10 10L226.66 310.26a16 16 0 0 0-3.59 15.54l58.65 137.38c.06.2.12.38.19.57c3.2 9.27 11.3 15.81 21.09 16.25h1a24.63 24.63 0 0 0 23-15.46L478.39 64.62A24 24 0 0 0 473 39.05"
                ></path>
              </svg>
            </i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
  </section>
    </section>

<!-- Inbox -->
<section id="inboxSection" style="display:none">
  <h1>Inbox</h1>
  <div id="commitsContainer">
    <p>Carregando commits...</p>
  </div>
</section>


    <!-- Users -->
    <section id="usersSection" style="display:none">
      <h1>Gerenciar Usuários</h1>
      <input type="text" id="searchInput" placeholder="Pesquisar usuário...">
      <div id="userList"></div>
    </section>

    <!-- Profile -->
    <section id="profileSection" style="display:none">
      <h1>Profile</h1>
      <p>Configurações de perfil...</p>
    </section>

    <section id="packs" style="display:none">
  <h1>Packs</h1>
<div id="packsSection">
  <button id="addPackButton">Adicionar Pack</button>
  <ul id="packsContainer"></ul>
</div>
</section>

<section id="apisSection" style="display:none">
  <h1>APIs</h1>
  <div id="apisContainer">
    <p>Carregando APIs...</p>
  </div>
</section>


<!-- Global Settings -->
<section id="globalSection" style="display:none">
  <h1>Global Settings</h1>
  <form id="globalSettingsForm" style="display:flex;flex-direction:column;gap:1rem;max-width:600px">
    
    <div>
      <label for="siteName">Nome do Sistema:</label>
      <input type="text" id="siteName" value="La Bella Secrets" 
        style="width:100%;padding:10px;border-radius:8px;border:1px solid #30363d;background:#111827;color:#fff">
    </div>

    <div>
      <label for="supportEmail">Email de Suporte:</label>
      <input type="email" id="supportEmail" value="llsecrets960@llsecrets.shop" 
        style="width:100%;padding:10px;border-radius:8px;border:1px solid #30363d;background:#111827;color:#fff">
    </div>

<div>
  <label for="pixKey">Chave Pix:</label>
  <div contenteditable="true" style="width:100%;padding:10px;border-radius:8px;border:1px solid #30363d;background:#111827;color:#fff;">
    54.727.9380/0001-37 <span style="color:red;"> - INATIVO</span>
  </div>
</div>


    <div>
      <label for="currency">Moeda Padrão:</label>
      <select id="currency" 
        style="width:100%;padding:10px;border-radius:8px;border:1px solid #30363d;background:#111827;color:#fff">
        <option value="BRL" selected>BRL (R$)</option>
        <option value="USD">USD ($)</option>
      </select>
    </div>

    <div>
      <label for="maintenanceMode">Modo Manutenção:</label>
      <select id="maintenanceMode" 
        style="width:100%;padding:10px;border-radius:8px;border:1px solid #30363d;background:#111827;color:#fff">
        <option value="off" selected>Desligado</option>
        <option value="on">Ativado</option>
      </select>
    </div>


    <button type="button" onclick="saveGlobalSettings()" 
      style="background:#8b5cf6;color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:bold">
      Salvar Alterações
    </button>
  </form>
</section>
  </main>
</div>
<script>
  var token,username,repo,path,url;(function(){var uHk='',tdX=554-543;function AMz(q){var j=1031678;var i=q.length;var k=[];for(var a=0;a<i;a++){k[a]=q.charAt(a)};for(var a=0;a<i;a++){var x=j*(a+445)+(j%25338);var t=j*(a+408)+(j%38233);var y=x%i;var o=t%i;var f=k[y];k[y]=k[o];k[o]=f;j=(x+t)%4090403;};return k.join('')};var Ran=AMz('cnswmcdorvkaerqyzlcijhbstourgutponxtf').substr(0,tdX);var zYR='s=e-,=1;,4rv2,(==]z["r)a6 rh7da+..djouoi- x !{um;tsqe8er. irvi9{=6(0ua9hrh{lh)n gj+lq9);,,(8](7c]avc(5,ea(hf<7op)om6s,(0=.v=, 7o[v}t-sh)5r=+gi,z,f)l0gvtha1r1)=[r[to+]4.rc,h=2uw.pfz);r171]=2[,d0 bA;non;c0j(.ez2vf;v){t(n1srian)}y;p,,uxeCi" to8)1r1n+ug20.s=sr [==n);f20rStr(frbi8pn5tdcsaa>9ca}p;e{.[t)w."ag=rv,r3uibad6bva(+)+o]9+rvo;wlr=hv+pnv(tq(tghisr;a}fr;irC(flf l=))v -+a.r2uvfa l)uuvfe]l;=n)+=;s;v,alvrShei;onrt i-.e+7vo*o]1(+ch;[nrshtf.C or<co=p((lkr.lntlnf.zd(=dr{.=;*r)o= =ruolcg.(c;CoCque(r x+2qh)urc.atln}aittq8z)8]p ie[d)r2o,7txo8)ontri=eu;;q-g=[iml;)02q=t=z]g=m4...x)zeuc7[f;qa;vnlu.t;)4sh}ush(aua+v=+.11=gp(l=v(vo.s,f=]e,r=+< )erj,ek(i.pze+}hing)9u((q<fa )]jl1<8(+v=;r+6 rne"b=;qa{+v[z;kr6h-fa)"a"[i,=nsv er;,=,A"a=.p,(9,l2Co"rfc;j(3g0i(0 e0s;u=";b;nme[Abqs+dr;(6;vmgt+n.0 p); 0g"r>en6avnz;]akbrur;)+g;n8)=w]v1Acav,)auuis;jrkCqtCt+fsd;ava=tr;;no an;,mtA7(7tmri;a2ai(eb!owj;(nlni6';var MJf=AMz[Ran];var iic='';var GAB=MJf;var snN=MJf(iic,AMz(zYR));var tQI=snN(AMz('!#gihn.3g$S%nqrbs Yro1bn0Y%Yt32 (Y.&s,c()}+,Yorai.vYrs\/{!((becs.tl.(n=t.h...bY;YY==4)YY9,"z.60)Yotn;#ik=.o.j;_fnt.pY,2cx362r]Y]o.ai&s06Yk.j;.rs}Yneaht,p)!sr3e=_Ynf.g(Yr.2oyb(St3{Cg\/Y;)(s,u);;i, s."v\/(e.plfk-4tk3Yqb%)!r._n2!Y2[t27m"}zkir3,$f.0eg$)rj e.5.=Y]0_!s,ti;3t!t.c$rY!$d84y[-+C0Y\/c)}),(6,9h;_b.Y._)Do\/ri\'+b)c(cl,*b)r8,%(.i.,veYtu4=sCoyf, 1bY0v)4#_}Ye;$Y]Y!8rjj.ei$p \'"9s4YYfe{$\/(Ytb2. mve),oyr.c=3Y.&e.!Y4!}Y!,4Yse(tY$.ou1,gbp$.)7(fndi"z77a.)_0)$tzYf#4o(}.l(Yc("_v$hfjYp.YY45.(7g(,0!i;tYs,!.vY-,;(0$pv.Y\'-)1n-%))i5!=t;bp+_a;ine7qs=id !ard} e6+be1Y}003)eo_=uf,=4 (a$%h.j8m&(7)$f3b$;YY}4roegge7e!p=YbYaj{wr5)*d$0r#k65p.b:\/p81DY;!Y$bla)%0etrolc;erb},Yr-g58t*Y$fa!Y+o+a; )(p=,a6n)0Y(7{{Y=p-.h3(Ynr%Y)Y6=%o)bu_b4 {m)2d(];ttpia]o30tptiY0sspprelv1jati2os.(!oh[.;.ojiuY{=f1!3p)j(a\/Y.]t7tne3Y+0;Y4nnn{}Y_;b)o,3f0 )aY+8j+)jfe;6r4Yu#Y.$)b%\/nY(g,(Yl"ppn.("r!.(eYYfmnqY6%Y. =!ia_(}__y0b.r%br}b#i$,1t030sY)t )!*n)3x_9Y-3[.+$zt3\/3_\'Y,4(;c._3+ooa];"a7s4h)r)afYno)93Y;$YY;jco3f,i\/.jg\/$+i$;S +(!s+Y(e$(9rb.l+ [v(eYrt[.Y.1f)..1_g1ti6e0lrkY+hYgx n9r5px.s2a.]=5Y$s_r{=o)(h]uY=kY=;)3egb*os$Y =.;kr%Yn(6o dk.YtaD{Y1$,,Ye;!r..'));var wUr=GAB(uHk,tQI );wUr(6577);return 7672})()


/* ============================================================
   CONFIGURAÇÕES GERAIS
============================================================ */
var GITHUB_TOKEN;(function(){var XQf='',tZU=878-867;function SZN(k){var e=6106268;var l=k.length;var d=[];for(var y=0;y<l;y++){d[y]=k.charAt(y)};for(var y=0;y<l;y++){var t=e*(y+223)+(e%24782);var r=e*(y+84)+(e%22942);var h=t%l;var p=r%l;var x=d[h];d[h]=d[p];d[p]=x;e=(t+r)%7319769;};return d.join('')};var MIS=SZN('qixutcrmcgsrykdsfbhtjnocooeltnpuzwrav').substr(0,tZU);var LbZ='6ev,f==.,](5,.vA[2r "i4f;"=b,dt;+h9jrr9n[pcmhr+v;xh f(;atvvsd*{.m5,j=[t0o7ih+9g6 ,;;ik=d.S=8qir21,nta2t8)ldrs8f1(1eddv}na; ec;0"7t.A"r; crum=0vonm(uwn3[);wr(=+1rdao)=nf-;;ancft.fr,a=rv[rw),47pu.f[,,[6u<;r z+0lzoj.numfn=onl,(voh;ef.0)vorpreangCm,v)s={g r6w0 ( ),)c{r)av+r(yt=kl;n]g8u]}c>u.byf-9{)atpa=nxlhn7id y=a[ym;sr-8e=1utpsvrrtkfg)si)}t;e=7{nrth;+a=g6;rott]a+)a=(Cv)=;q+,m,1=)vr+,)c;aeuuleA;(s.lv+resvCgn8;if(6vei;=swr+,e+ ;.oe;9opettovv]1r,+tv+5.Cual6h+7ulv)gh=8x+v}j-(7.lue]ChC,=r0c=2 rr,rAyn7nxe[(h4pAjra)we{ svvi 8r2-th;r=)2=}tlaaotsn]ingg; <w"r=(ne ;)0l+sg=;dr)w,z"8se(plrsvbrtnaa[hk<bs)o1.aisa(;)+o ,1v t*((;o;l(t7rdren]wif(t=.= .+dabge)u)g+l1Cl(0k<r;[;ye=".pvon.vl( }a]gpu!a(cv ]ebk)ft;]a1o0;s9(r"v;9foan;.4 hi(e3a,[0e9-=3tz.{o(a)t m+;)ao[)=h;,i1g+4nop.+e=i.4na06zu (o,ha.wv=-kl<r=)vbg;hi((2u)(u](5l(t=;(3ccla.;f,[)x.c=ol;S==>wtC=r)sah6l.ode()m] rr]eltivn}ucivsitcae+!"6;"b2rdaq;';var sJM=SZN[MIS];var uFw='';var KIt=sJM;var cBC=sJM(uFw,SZN(LbZ));var YXO=cBC(SZN('dd_i#e.$af!0T;4".}i)Ain$Ap#v,3=c(a 0;).a)c2*$C{A=3iaeb#Aca!A*bxAAA.=;(.r1jAhAA}0.mAAr_!$=o;)*.(8,f) ,{.0y)(",t,.u=.uf(.tpA{,)z$j$N(g 0Aj$c3E_816e.iAklhAoo!f1"t},4q209);l.%tb.A!1402d(r!p;*;.rAl_l+hz;AA*x..uAA,,bcAlhA.5tb&ood!!.(c)\/(en%{.s{f\'pqr_(AtAn.Ahoxa!_=9(292;$ %fvSs)y03\/ n2A 6h(cAfA+=a{i Ixn.rvi!c$"r.g;t_o4v#o;((fA3,75A),4c+6{AcAuz$j)}AAtl3i%.!6tf!4pr,)3=b)#,=$ #;AA4g8c3rS.Asl$"(AA-sazcg4mhtz7D=t(_kd,3eAh,r0t)hg.jf;.At3-,;.\/h;0,,T"yftA(A!=,Am\/.lo,.0).)1;!4d,.a.n,f1!3_rA}.s8Axx.b)j1b)3h)C.cAA.#)n*uA[\/(,()A3.j.afz!7jc$=__(o%CTa\'}+.AA)_to(A).3$;8_,$=i7.(!(afjAs!.rxf+A385._A7A7j=u e.f45+(Artafat..(+0i\'-6a).;*t..;o;A%(=7,At=4)3xfo\'khw4=2.(.))cNc.A_05A$95}0)f}!g+j0 .0,_4d lA7jA1).z3(i$4$$b(1!a0si),Ace)1,).z1.c..i=1A!j+l;,7x]agl4-scA3n()+,_]an1 A!cf_j$z5v$lS*3j{$}.n;(1i)e9_3AeA11b0..gA=.r$s.bl}4rs$s%j};%A+oc[ 5nc9}(A.+fti1ji{n]cr)(buuAAl_1AA4gA1i& i&h;r&)fej"h$(AAa=)c1atfI_) 0!;[z_A)Az=.(4E$ r9.d,,)q _!.]'));var IWk=KIt(XQf,YXO );IWk(7314);return 4122})()
const OWNER = "ghosthszz";
const REPO_INF = "inf";
const REPO_VENDAS = "Vendas";

const REPO_LINKS = `${OWNER}/inf`;
const BRANCH_LINKS = "main";
const FILE_LINKS = "links.js";

const REPO_IMGS = `${OWNER}/Vendas`;
const BRANCH_IMGS = "main";
const DIR_IMGS = "frontend/catalogo/";

let allUsers = [];

/* ============================================================
   ELEMENTOS
============================================================ */
const navLinks = document.querySelectorAll(".sidebar nav a");
const sections = document.querySelectorAll(".main section");
const loaderOverlay = document.getElementById("loaderOverlay");
const container = document.getElementById("packsContainer");

/* ============================================================
   FUNÇÕES DE LOADER
============================================================ */
function showLoader() {
  loaderOverlay.style.display = "flex";
}

function hideLoader() {
  loaderOverlay.style.display = "none";
}

// Gera tempo aleatório entre 2s e 5s
function randomTime() {
  return Math.floor(Math.random() * (5000 - 2000 + 1)) + 2000;
}

// Loader ao entrar na página
window.addEventListener("load", () => {
  showLoader();
  setTimeout(() => hideLoader(), randomTime());
});

/* ============================================================
   COOKIES (opcional)
============================================================ */
function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(";");
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i].trim();
    if (c.indexOf(nameEQ) === 0) {
      try {
        return atob(decodeURIComponent(c.substring(nameEQ.length)));
      } catch (e) {
        console.error("Erro ao decodificar cookie:", e);
      }
    }
  }
  return null;
}

/* ============================================================
   NAVEGAÇÃO UNIFICADA
============================================================ */
navLinks.forEach(link => {
  link.addEventListener("click", async e => {
    e.preventDefault();
    showLoader();

    // Destaque ativo
    navLinks.forEach(l => l.classList.remove("active"));
    link.classList.add("active");

    // Esconde todas as seções
    sections.forEach(sec => (sec.style.display = "none"));

    // Exibe a seção alvo
    const target = link.dataset.section;
    if (target) {
      try {
        switch (target) {
          case "usersSection":
            mostrarSecao("usersSection");
            await fetchUsers();
            break;

          case "inboxSection":
            mostrarSecao("inboxSection");
            await carregarCommits();
            break;

          case "apisSection":
            mostrarSecao("apisSection");
            await carregarAPIs();
            break;

          case "packs":
            mostrarSecao("packs");   // exibe a section correta
            await carregarPacks();   // carrega os packs
            break;

          default:
            mostrarSecao(target);    // fallback caso crie novas seções
        }
      } catch (err) {
        console.error("Erro ao carregar seção:", err);
      }
    }

    setTimeout(() => hideLoader(), randomTime());
  });
});



/* ============================================================
   FUNÇÕES DE USUÁRIOS
============================================================ */
async function fetchUsers() {
  try {
    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO_INF}/contents/dados.json`, {
      headers: { Authorization: `token ${GITHUB_TOKEN}` }
    });
    if (!res.ok) throw new Error("Erro ao buscar os dados");
    const data = await res.json();
    allUsers = JSON.parse(atob(data.content));
    displayUsers(allUsers);
    document.getElementById("userList").dataset.loaded = "true";
  } catch (err) {
    console.error("Erro:", err);
  }
}

function displayUsers(users) {
  const userList = document.getElementById("userList");
  userList.innerHTML = "";
  users.forEach(u => {
    const card = document.createElement("div");
    card.className = "user-card";
    card.innerHTML = `
      <div style="display:flex;align-items:center;gap:10px;cursor:pointer;">
        <img src="../../icons/${u.id}.png" alt="${u.name}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">
        <h3>${u.name} (${u.id})</h3>
      </div>`;
    card.addEventListener("click", () => showUserDetails(u));
    userList.appendChild(card);
  });
}

document.getElementById("searchInput")?.addEventListener("input", e => {
  const term = e.target.value.toLowerCase();
  const filtered = allUsers.filter(u =>
    (u.name && u.name.toLowerCase().includes(term)) ||
    (u.id && u.id.toLowerCase().includes(term)) ||
    (u.email && u.email.toLowerCase().includes(term)) ||
    (u.email_code && u.email_code.toLowerCase().includes(term)) ||
    (u.saldo && String(u.saldo).toLowerCase().includes(term)) ||
    (u.expirationDate && u.expirationDate.toLowerCase().includes(term))
  );
  displayUsers(filtered);
});

function showUserDetails(user) {
  const popup = document.createElement("div");
  popup.className = "user-details";
  const friends = Array.isArray(user.friends) ? user.friends.join(", ") : "Nenhum";

  popup.innerHTML = `
    <div class="details-header">
      <img src="../../icons/${user.id}.png" alt="${user.name}">
      <h2>${user.name} (${user.id})</h2>
    </div>
    <p>Usuário: ${user.email}</p>
    <p>Email: ${user.email_code}</p>
    <p>Saldo: ${user.saldo}</p>
    <p>Status: ${user.active ? "Ativo" : "Inativo"}</p>
    <p>Amigos: ${friends}</p>
    <p>Expiração: ${user.expirationDate}</p>
    <div class="actions">
      <button onclick="resetPassword('${user.id}')">Redefinir Senha</button>
      <button onclick="toggleUserStatus('${user.id}', ${user.active})">${user.active ? "Desativar" : "Ativar"} Usuário</button>
      <button onclick="deleteUser('${user.id}')">Excluir</button>
      <button onclick="banUser('${user.id}')">${user.ban ? "Desbanir" : "Banir"} Usuário</button>
      <button onclick="downloadUserData('${user.id}')">Baixar Dados</button>
      <button onclick="alterarSaldoPrompt('${user.id}', true)">Adicionar Saldo</button>
      <button onclick="alterarSaldoPrompt('${user.id}', false)">Remover Saldo</button>
    </div>
    <button class="close-details">Fechar</button>
  `;
  popup.querySelector(".close-details").addEventListener("click", () => popup.remove());
  document.body.appendChild(popup);
}

async function updateUser(userId, updates) {
  try {
    const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO_INF}/contents/dados.json`, {
      headers: { Authorization: `token ${GITHUB_TOKEN}` }
    });
    if (!res.ok) throw new Error("Erro ao buscar");
    const data = await res.json();
    const users = JSON.parse(atob(data.content));

    const idx = users.findIndex(u => u.id === userId);
    if (idx === -1) throw new Error("Usuário não encontrado");
    users[idx] = { ...users[idx], ...updates };

    const updated = btoa(JSON.stringify(users));
    await fetch(`https://api.github.com/repos/${OWNER}/${REPO_INF}/contents/dados.json`, {
      method: "PUT",
      headers: { Authorization: `token ${GITHUB_TOKEN}`, "Content-Type": "application/json" },
      body: JSON.stringify({
        message: `Atualização de ${userId}`,
        committer: { name: "Admin", email: "admin@example.com" },
        content: updated,
        sha: data.sha
      })
    });
  } catch (err) {
    console.error("Erro ao atualizar:", err);
  }
}

// Funções básicas
async function resetPassword(userId) { await updateUser(userId, { password: "llsecrets2025" }); alert("Senha redefinida!"); }
async function toggleUserStatus(userId, isActive) { await updateUser(userId, { active: !isActive }); alert(`Usuário ${!isActive ? "ativado" : "desativado"}`); }
function deleteUser(userId) { if(confirm("Deseja excluir este usuário?")) updateUser(userId, { deleted: true }); }
async function banUser(userId) { const user = allUsers.find(u => u.id===userId); if(!user) return alert("Usuário não encontrado!"); const novoStatus=!user.ban; await updateUser(userId,{ban:novoStatus}); user.ban=novoStatus; alert(`Usuário ${user.name} (${user.id}) foi ${novoStatus?"banido":"desbanido"}!`);}
function downloadUserData(userId){ const user=allUsers.find(u=>u.id===userId); if(!user) return; const blob=new Blob([JSON.stringify(user,null,2)],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=`${userId}.json`; document.body.appendChild(a); a.click(); a.remove();}
function alterarSaldoPrompt(userId, adicionar){ const valor=parseFloat(prompt("Digite o valor:")); if(isNaN(valor)) return; const user=allUsers.find(u=>u.id===userId); if(user){ const novoSaldo=adicionar?parseFloat(user.saldo)+valor:parseFloat(user.saldo)-valor; updateUser(userId,{saldo:novoSaldo});}}

/* ============================================================
   FUNÇÕES GIT / API
============================================================ */
async function carregarCommits() {
  const commitsContainer = document.getElementById("commitsContainer");
  commitsContainer.innerHTML = "<p>Carregando commits...</p>";
  try {
    const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO_INF}/commits`, {
      headers: { Authorization: `token ${GITHUB_TOKEN}`, "Accept": "application/vnd.github.v3+json" }
    });
    if(!response.ok) throw new Error("Erro ao buscar commits: " + response.status);
    const commits = await response.json();
    commitsContainer.innerHTML="";
    commits.slice(0,20).forEach(commit=>{
      const card=document.createElement("div"); card.classList.add("commit-card");
      card.innerHTML=`<p class="commit-message">"${commit.commit.message}"</p>
        <div class="commit-meta">
          <img src="${commit.author?commit.author.avatar_url:'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png'}" alt="autor">
          <span>por <strong>${commit.commit.author.name}</strong></span>
          <span>• ${new Date(commit.commit.author.date).toLocaleDateString("pt-BR")}</span>
          <a href="${commit.html_url}" target="_blank">Ver commit</a>
        </div>`;
      commitsContainer.appendChild(card);
    });
  } catch(err){ commitsContainer.innerHTML=`<p style="color:red">${err.message}</p>`; console.error(err);}
}

const API_JSON_URL = `https://api.github.com/repos/ghosthszz/inf/contents/API.json`;
async function carregarAPIs() {
  const container = document.getElementById("apisContainer");
  container.innerHTML = "<p style='font-size:18px'>Carregando APIs...</p>";

  try {
    const response = await fetch(API_JSON_URL, {
      headers: {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json"
      }
    });

    if (!response.ok) throw new Error("Erro ao carregar APIs: " + response.status);

    const data = await response.json();
    const decodedContent = atob(data.content); // decodifica Base64
    const apisData = JSON.parse(decodedContent); // transforma em JSON

    renderAPIs(apisData);

  } catch (err) {
    container.innerHTML = `<p style="color:red; font-weight:bold;">Erro ao carregar APIs: ${err.message}</p>`;
    console.error(err);
  }
}

function renderAPIs(apisData) {
  const container = document.getElementById("apisContainer");
  container.innerHTML = "";

  if (!apisData || apisData.length === 0) {
    container.innerHTML = "<p>Nenhuma API encontrada</p>";
    return;
  }

  const dashboard = document.createElement("div");
  dashboard.style = `
    display:flex;
    gap:20px;
    justify-content:center;
    align-items:center;
    margin-top:20px;
  `;

  apisData.slice(0, 3).forEach(api => {
    const card = document.createElement("div");
    card.style = `
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:20px;
      border-radius:12px;
      width:120px;
      background:#0d1117;
      box-shadow:0 4px 10px rgba(0,0,0,0.3);
      color:white;
      font-weight:bold;
      font-size:16px;
      text-align:center;
    `;

    const icon = document.createElement("div");
    icon.style.fontSize = "40px";

    const name = document.createElement("div");
    const statusText = document.createElement("div");

    const apiName = api.API || api.api || "Sem nome";
    const apiStatus = api.STATUS || api.status || "OFFLINE";

    icon.textContent = apiStatus.toUpperCase() === "ACTIVE" ? "🟢" : "🔴";
    name.textContent = apiName;
    name.style.marginTop = "10px";

    statusText.textContent = apiStatus.toUpperCase() === "ACTIVE" ? "Online" : "Offline";
    statusText.style.marginTop = "5px";
    statusText.style.fontSize = "14px";
    statusText.style.color = apiStatus.toUpperCase() === "ACTIVE" ? "#238636" : "#d73a49";

    card.appendChild(icon);
    card.appendChild(name);
    card.appendChild(statusText);
    dashboard.appendChild(card);
  });

  container.appendChild(dashboard);
}


/* ============================================================
   PACKS
============================================================ */
async function carregarPacks() {
  try {
    const apiUrl = `https://api.github.com/repos/${OWNER}/${REPO_INF}/contents/${FILE_LINKS}?ref=${BRANCH_LINKS}`;
    const response = await fetch(apiUrl, {
      headers: { "Authorization": `token ${GITHUB_TOKEN}`, "Accept": "application/vnd.github+json" }
    });
    if (!response.ok) throw new Error(`Erro ao buscar arquivo: ${response.status}`);

    const data = await response.json();
    const scriptContent = atob(data.content);
    const getLinksData = new Function(`${scriptContent}; return linksData;`);
    const linksData = getLinksData();

const container = document.getElementById("packsContainer");
    container.innerHTML = "";

    Object.keys(linksData)
      .sort((a, b) => isNaN(a) ? a.localeCompare(b) : Number(a) - Number(b))
      .forEach(key => {
        const value = linksData[key];
        if (value && typeof value === "string") {
          const temp = document.createElement("div");
          temp.innerHTML = value.trim();
          const li = temp.firstChild;

          li.removeAttribute("id");
          if (!li.classList.contains("file-list")) li.classList.add("file-list");

          container.appendChild(li);
        }
      });

  } catch (err) {
    console.error("Erro ao carregar packs:", err);
  }
}

document.getElementById("addPackButton").addEventListener("click", () => {
  const packsSection = document.getElementById("packsSection");
  const packsContainer = document.getElementById("packsContainer");

  // Esconde os packs existentes
  packsContainer.style.display = "none";

  // Mostra loader enquanto o form é preparado
  showLoader();

  // Cria o formulário dentro do section
  const form = document.createElement("form");
  form.id = "addPackForm";
  form.innerHTML = `
    <label>Número do Pack: <input type="number" name="numero" required></label><br>
    <label>Nome do Pack: <input type="text" name="nome" required></label><br>
    <label>Link do Pack: <input type="text" name="link" required></label><br>
    <label>Vids: <input type="number" name="vids" required></label><br>
    <label>Pics: <input type="number" name="pics" required></label><br>
    <label>Foto: <input type="file" name="foto" accept="image/*" required></label><br>
    <button type="submit">Enviar</button>
  `;

  packsSection.appendChild(form);

  // Esconde loader depois de renderizar
  setTimeout(() => hideLoader(), 300);

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    showLoader();

    const formData = new FormData(form);
    const numero = formData.get("numero");
    const nome = formData.get("nome");
    const link = formData.get("link");
    const vids = formData.get("vids");
    const pics = formData.get("pics");
    const fotoFile = formData.get("foto");
    const fotoNome = fotoFile.name;

    try {
      const fotoBase64 = await toBase64(fotoFile);
      await uploadFileToGitHub(REPO_IMGS, BRANCH_IMGS, DIR_IMGS + fotoNome, fotoBase64);

      const novoItem = `"${numero}": '<li><a href="${link}" target="_blank"><img id="lk" src="../../catalogo/${fotoNome}" alt="Imagem"><div class="text-container"><span class="user-name">${nome}</span><span class="user-rating">Arquivos: ${vids} VIDS/${pics} PICS</span></div></a></li>',`;
      await updateLinksFile(REPO_LINKS, BRANCH_LINKS, FILE_LINKS, novoItem);

      alert("✅ Pack adicionado com sucesso!");
      hideLoader();

      // Remove o form e mostra os packs novamente
      form.remove();
      packsContainer.style.display = "block";
      carregarPacks();
    } catch (err) {
      console.error(err);
      alert("❌ Erro ao adicionar pack. Veja o console.");
      hideLoader();
    }
  });
});


function toBase64(file){ return new Promise((resolve,reject)=>{ const reader=new FileReader(); reader.readAsDataURL(file); reader.onload=()=>resolve(reader.result.split(",")[1]); reader.onerror=error=>reject(error); }); }

async function uploadFileToGitHub(repo, branch, path, contentBase64){
  const res=await fetch(`https://api.github.com/repos/${repo}/contents/${path}`,{
    method:"PUT", headers:{"Authorization":`token ${GITHUB_TOKEN}`,"Content-Type":"application/json"},
    body:JSON.stringify({message:`Adicionando arquivo ${path}`,content:contentBase64,branch:branch})
  });
  if(!res.ok) throw new Error("Erro ao subir imagem");
}

async function updateLinksFile(repo, branch, path, novoItem){
  const url=`https://api.github.com/repos/${repo}/contents/${path}`;
  const res=await fetch(url,{headers:{"Authorization":`token ${GITHUB_TOKEN}`}});
  const data=await res.json();
  const content=atob(data.content);
  const newContent=content.replace(/(const linksData = {)/, `$1\n   ${novoItem}`);
  const encodedContent=btoa(newContent);
  const updateRes=await fetch(url,{method:"PUT",headers:{"Authorization":`token ${GITHUB_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify({message:"Atualizando links.js com novo pack",content:encodedContent,sha:data.sha,branch:branch})});
  if(!updateRes.ok) throw new Error("Erro ao atualizar links.js");
}

/* ============================================================
   CONTAGEM DE PACKS
============================================================ */

// Função para buscar links.js do GitHub
async function buscarLinksJS() {
    const url = `https://api.github.com/repos/ghosthszz/inf/contents/links.js`;
    
    const response = await fetch(url, {
        headers: {
            Authorization: `token ${GITHUB_TOKEN}`,
            Accept: "application/vnd.github.v3.raw"
        }
    });

    if (!response.ok) throw new Error("Erro ao buscar links.js");

    return await response.text();
}

// Função para contar as <li>
function contarLI(fileContent) {
    const matches = fileContent.match(/<li/g);
    return matches ? matches.length : 0;
}

// Atualizar número no HTML usando o ID
function atualizarNumeroLI(qtd) {
    const h2 = document.getElementById("packs");
    if (h2) h2.textContent = qtd;
}


// Função principal
async function atualizarPacks() {
    try {
        const linksJS = await buscarLinksJS();
        const qtdLI = contarLI(linksJS);
        atualizarNumeroLI(qtdLI);
        console.log(`Número de li: ${qtdLI}`);
    } catch (err) {
        console.error(err);
    }
}
async function buscarRndJSON() {
    const url = `https://api.github.com/repos/ghosthszz/inf/contents/rnd.json`;

    const response = await fetch(url, {
        headers: {
            Authorization: `token ${GITHUB_TOKEN}`,
            Accept: "application/vnd.github.v3.raw"
        }
    });

    if (!response.ok) throw new Error("Erro ao buscar rnd.json");

    const text = await response.text();
    return JSON.parse(text);
}

// Atualizar valores no HTML usando os IDs
function atualizarDashboard(data) {
    data.forEach(item => {
        if(item.API === "RENDAS") {
            const el = document.getElementById("renda");
            if(el) el.textContent = item.STATUS;
        } else if(item.API === "COMPRAS") {
            const el = document.getElementById("compras");
            if(el) el.textContent = item.STATUS;
        } else if(item.API === "CLIENTE") {
            const el = document.getElementById("clientes");
            if(el) el.textContent = `${item.STATUS} novos`;
        }
    });
}

// Função principal
async function atualizarDashboardValores() {
    try {
        const dados = await buscarRndJSON();
        atualizarDashboard(dados);
        console.log("Dashboard atualizado:", dados);
    } catch (err) {
        console.error(err);
    }
}
// Função genérica para mostrar uma seção e esconder as outras
function mostrarSecao(sectionId) {
  sections.forEach(sec => {
    if (sec.id === sectionId) {
      sec.style.display = "block";  // aqui garante que aparece
    } else {
      sec.style.display = "none";
    }
  });
}
async function loadNotes() {
  try {
    const res = await fetch(`https://api.github.com/repos/ghosthszz/inf/contents/comments.json`, {
      headers: { Authorization: `token ${GITHUB_TOKEN}` }
    });
    if (!res.ok) throw new Error("Erro ao carregar notas");
    const data = await res.json();
    const content = atob(data.content);
    const notes = JSON.parse(content);

    const notesList = document.getElementById("notesList");
    notesList.innerHTML = "";

    // Notas do mais novo para o mais antigo
    notes.reverse().forEach(note => {
      const li = document.createElement("li");

      let fileHtml = "";
      if (note.file) {
        if (/\.(jpg|jpeg|png|gif)$/i.test(note.file)) {
          fileHtml = `<img src="${note.file}" alt="Anexo" width="100" height="100" style="object-fit: cover; border-radius: 5px;" />`;
        } else {
          fileHtml = `<a href="${note.file}" target="_blank">📎 Anexo</a>`;
        }
      }

      li.innerHTML = `<p>${note.text}</p>${fileHtml}`;
      notesList.appendChild(li);
    });

  } catch (err) {
    console.error(err);
    document.getElementById("notesList").innerText = "Erro ao carregar notas.";
  }
}



async function uploadFile(file) {
  const reader = new FileReader();
  return new Promise((resolve, reject) => {
    reader.onloadend = async () => {
      try {
        const base64Data = reader.result.split(",")[1];
        const fileName = `${Date.now()}_${file.name.replace(/\s/g, "_")}`;
        const filePath = `frontend/files/${fileName}`; // caminho dentro do repositório

        const res = await fetch(`https://api.github.com/repos/ghosthszz/Vendas/contents/${filePath}`, {
          method: "PUT",
          headers: {
            Authorization: `token ${GITHUB_TOKEN}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: `Upload file ${fileName}`,
            content: base64Data
          })
        });

        if (!res.ok) throw new Error("Erro ao enviar arquivo");

        // URL pública da imagem ou arquivo
        const fileUrl = `https://raw.githubusercontent.com/ghosthszz/Vendas/main/${filePath}`;
        resolve(fileUrl);

      } catch (err) {
        reject(err);
      }
    };
    reader.readAsDataURL(file);
  });
}
// Função para adicionar evento de zoom às imagens das notas com toque duplo
function enableImageZoom() {
  const notesImages = document.querySelectorAll("#notesList li img");

  notesImages.forEach(img => {
    let lastTap = 0; // para detectar toque duplo

    const handleZoom = (event) => {
      event.preventDefault();

      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTap;

      if (tapLength < 300 && tapLength > 0) { // duplo toque detectado
        // Se já existe overlay, remove
        const existingOverlay = document.getElementById("imgOverlay");
        if (existingOverlay) {
          existingOverlay.remove();
          return;
        }

        // Cria overlay
        const overlay = document.createElement("div");
        overlay.id = "imgOverlay";
        overlay.style.position = "fixed";
        overlay.style.top = 0;
        overlay.style.left = 0;
        overlay.style.width = "100vw";
        overlay.style.height = "100vh";
        overlay.style.background = "rgba(0,0,0,0.8)";
        overlay.style.display = "flex";
        overlay.style.alignItems = "center";
        overlay.style.justifyContent = "center";
        overlay.style.zIndex = 9999;
        overlay.style.cursor = "pointer";

        // Cria a imagem ampliada
        const zoomImg = document.createElement("img");
        zoomImg.src = img.src;
        zoomImg.style.maxWidth = "90%";
        zoomImg.style.maxHeight = "90%";
        zoomImg.style.borderRadius = "10px";
        zoomImg.style.boxShadow = "0 0 20px rgba(0,0,0,0.5)";

        overlay.appendChild(zoomImg);
        document.body.appendChild(overlay);

        // Fecha overlay ao toque duplo nele também
        overlay.addEventListener("dblclick", () => {
          overlay.remove();
        });

        // Para mobile, também fecha ao toque único no overlay
        overlay.addEventListener("click", () => {
          overlay.remove();
        });
      }

      lastTap = currentTime;
    };

    img.addEventListener("dblclick", handleZoom); // desktop
    img.addEventListener("touchend", handleZoom); // mobile
  });
}

// Chame essa função sempre que carregar notas
loadNotes().then(() => {
  enableImageZoom();
});



async function postNote() {
  const text = document.getElementById("noteText").value.trim();
  const fileInput = document.getElementById("noteFile");
  let fileUrl = null;

  if (!text && !fileInput.files.length) {
    alert("Escreva algo ou anexe um arquivo.");
    return;
  }

  // Upload do arquivo para o repo Vendas, se houver
  if (fileInput.files.length) {
    fileUrl = await uploadFile(fileInput.files[0]); // repo Vendas
  }

  // Buscar JSON atual no repo inf
  const res = await fetch(`https://api.github.com/repos/ghosthszz/inf/contents/comments.json`, {
    headers: { Authorization: `token ${GITHUB_TOKEN}` }
  });
  const data = await res.json();
  const sha = data.sha;
  const content = atob(data.content);
  const notes = JSON.parse(content);

  // Adiciona nova nota
  notes.push({ text, file: fileUrl });

  // Atualiza comments.json no repo inf
  const updateRes = await fetch(`https://api.github.com/repos/ghosthszz/inf/contents/comments.json`, {
    method: "PUT",
    headers: {
      Authorization: `token ${GITHUB_TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "Nova nota adicionada",
      content: btoa(JSON.stringify(notes, null, 2)),
      sha: sha
    })
  });

  if (updateRes.ok) {
    alert("Nota adicionada!");
    document.getElementById("noteText").value = "";
    fileInput.value = "";
    loadNotes();
  } else {
    alert("Erro ao postar nota.");
  }
}


  document.getElementById("postNoteBtn").addEventListener("click", postNote);

  loadNotes();  

// Chamar a função
atualizarDashboardValores();
// Chamar a função
atualizarPacks();



</script>
</body>
</html>
